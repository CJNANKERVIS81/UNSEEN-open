

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Retrieve &mdash; unseen_open  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> unseen_open
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Whats-unseen.html">What is UNSEEN?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Workflow.html">UNSEEN-open</a></li>
</ul>
<p class="caption"><span class="caption-text">The workflow:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="1.Retrieve.html">1. Retrieve</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.Retrieve.html#Use-xarray-to-visualize-the-netcdf-file">Use xarray to visualize the netcdf file</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.Retrieve.html#Download-all-data">Download all data</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.Retrieve.html#EOBS-data-download">EOBS data download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.1Merge.html">1.3 Merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.1Merge.html#Concatenate-SEAS5">Concatenate SEAS5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.1Merge.html#EOBS">EOBS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.2Mask.html">1.4 Masking: from grid to country-averaged timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.2Mask.html#Load-SEAS5-and-EOBS">Load SEAS5 and EOBS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.2Mask.html#Masking">Masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.2Mask.html#Illustrate-the-SEAS5-and-EOBS-masks-for-the-UK">Illustrate the SEAS5 and EOBS masks for the UK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.2Mask.html#Potential-improvements">Potential improvements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.3Upscale.html">1.5 Upscaling EOBS then Masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.3Upscale.html#Load-SEAS5-and-EOBS">Load SEAS5 and EOBS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.3Upscale.html#Masking">Masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.3Upscale.html#Illustrate-the-SEAS5-and-EOBS-masks-for-the-UK">Illustrate the SEAS5 and EOBS masks for the UK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.Preprocess/2.3Upscale.html#And-extract-the-spatial-average">And extract the spatial average</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3.Evaluate/3.Evaluate.html">Evaluating the UNSEEN ensemble</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">unseen_open</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>1. Retrieve</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/Notebooks/1.Download/Siberian_heatwave.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="1.-Retrieve">
<h1>1. Retrieve<a class="headerlink" href="#1.-Retrieve" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload

<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">##This is so variables get printed within jupyter</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ##import packages</span>
<span class="c1"># import cdsapi ## check the current working directory, which should be the UNSEEN-open directory</span>
<span class="c1"># import numpy as np</span>
<span class="c1"># import os</span>
<span class="c1"># import xarray as xr</span>
<span class="c1"># import matplotlib.pyplot as plt</span>
<span class="c1"># import cartopy</span>
<span class="c1"># import cartopy.crs as ccrs</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../../&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">src.CDSretrieve</span> <span class="k">as</span> <span class="nn">retrieve</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ##We want the working directory to be the UNSEEN-open directory</span>
<span class="c1"># pwd = os.getcwd() ##current working directory is UNSEEN-open/Notebooks/1.Download</span>
<span class="c1"># pwd #print the present working directory</span>
<span class="c1"># os.chdir(pwd+&#39;/../../&#39;) # Change the working directory to UNSEEN-open</span>
<span class="c1"># os.getcwd() #print the working directory</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Download-all-data">
<h1>Download all data<a class="headerlink" href="#Download-all-data" title="Permalink to this headline">¶</a></h1>
<p>We will be using the SEAS5 hindcast, which is a dataset running from 1981-2016. The hindcast is initialized every month with 25 ensemble members and the forecast run for 6 months, indicated by blue horizontal bars below. February is forecasted by 6 initialization months (September-February). We discard the first month of the forecast because of dependence between the forecasts, explained in the evaluation section and are left with 5 initialization months (Sep-Jan) and 25 ensemble members
forecasting february precipitation each year, totalling to an increase of 125 times the observed length.</p>
<p>For a summary of all available C3S seasonal hindcasts, their initialization months and more specifics, please see <a class="reference external" href="https://confluence.ecmwf.int/display/CKB/C3S+Seasonal+Forecasts">ECMWF page</a> and the <a class="reference external" href="https://doi.org/10.5194/gmd-12-1087-2019">SEAS5 paper</a>.</p>
<p><img alt="title" src="Notebooks/1.Download/../../graphs/Data_illustration.png" /></p>
<p>The first download example above downloaded all 25 ensemble members for the forecast initialized in January (the bottom bar). We should repeat this over the other initialization month and over all years (1981-2016).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">init_months</span><span class="p">,</span> <span class="n">leadtimes</span> <span class="o">=</span> <span class="n">retrieve</span><span class="o">.</span><span class="n">_get_init_months</span><span class="p">(</span><span class="n">target_month</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">init_months</span>
<span class="n">leadtimes</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[2, 1, 12]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([2, 3, 4]), array([3, 4, 5]), array([4, 5, 6])]
</pre></div></div>
</div>
<p>Leadtimes should be [[2,3,4],[3,4,5],[4,5,6]]</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retrieve</span><span class="o">.</span><span class="n">print_arguments</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
year = 1982 init_month = 2 leadtime_month = [2 3 4]
year = 1982 init_month = 1 leadtime_month = [3 4 5]
year = 1981 init_month = 12 leadtime_month = [4 5 6]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retrieve</span><span class="o">.</span><span class="n">print_arguments</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
year = 1981 init_month = 5 leadtime_month = [2 3 4]
year = 1981 init_month = 4 leadtime_month = [3 4 5]
year = 1981 init_month = 3 leadtime_month = [4 5 6]
year = 1982 init_month = 5 leadtime_month = [2 3 4]
year = 1982 init_month = 4 leadtime_month = [3 4 5]
year = 1982 init_month = 3 leadtime_month = [4 5 6]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retrieve</span><span class="o">.</span><span class="n">print_arguments</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">years</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span><span class="mi">2021</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
year = 2017 init_month = 2 leadtime_month = [2 3 4]
year = 2017 init_month = 1 leadtime_month = [3 4 5]
year = 2016 init_month = 12 leadtime_month = [4 5 6]
year = 2018 init_month = 2 leadtime_month = [2 3 4]
year = 2018 init_month = 1 leadtime_month = [3 4 5]
year = 2017 init_month = 12 leadtime_month = [4 5 6]
year = 2019 init_month = 2 leadtime_month = [2 3 4]
year = 2019 init_month = 1 leadtime_month = [3 4 5]
year = 2018 init_month = 12 leadtime_month = [4 5 6]
year = 2020 init_month = 2 leadtime_month = [2 3 4]
year = 2020 init_month = 1 leadtime_month = [3 4 5]
year = 2019 init_month = 12 leadtime_month = [4 5 6]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retrieve</span><span class="o">.</span><span class="n">print_arguments</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
year = 1982 init_month = 1 leadtime_month = [2]
year = 1981 init_month = 12 leadtime_month = [3]
year = 1981 init_month = 11 leadtime_month = [4]
year = 1981 init_month = 10 leadtime_month = [5]
year = 1981 init_month = 9 leadtime_month = [6]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retrieve</span><span class="o">.</span><span class="n">print_arguments</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="p">[</span><span class="mi">2015</span><span class="p">,</span><span class="mi">2016</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
year = 2016 init_month = 1 leadtime_month = [2]
year = 2015 init_month = 12 leadtime_month = [3]
year = 2015 init_month = 11 leadtime_month = [4]
year = 2015 init_month = 10 leadtime_month = [5]
year = 2015 init_month = 9 leadtime_month = [6]
</pre></div></div>
</div>
<p>For our download, we loop over initialization months and years. Because we only want February precipitation, the leadtime month (forecast length) changes with the initialization month. For example, in the September initialized forecasts, we only want the leadtime month 6 = February. For August initialized this is leadtime 5, etc. Furthermore, the year the forecast is initialized is required for the download. For September - December initialized forecasts, this is the target year-1. For January
it is the same year as the target year. For example, for the first two target years this looks like the following:</p>
<p>Write a function that is used for the download.</p>
<p>And start the download! In total, we request 35 years x initialization dates = 175 requests. I could try sending just 5 request of the different initialization dates for all years?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="c1">##current working directory is UNSEEN-open/Notebooks/1.Download</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;/lustre/soge1/projects/ls/personal/timo/UNSEEN-open&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retrieve_SEAS5</span><span class="p">(</span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2m_temperature&#39;</span><span class="p">,</span><span class="s1">&#39;2m_dewpoint_temperature&#39;</span><span class="p">],</span> <span class="n">target_months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
         <span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;../../../Siberia_example/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">retrieve_SEAS5</span><span class="p">(</span><span class="n">variables</span> <span class="o">=</span> <span class="s1">&#39;total_precipitation&#39;</span><span class="p">,</span> <span class="n">target_months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span>
         <span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;../UK_example/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ERA5-data-download">
<h1>ERA5 data download<a class="headerlink" href="#ERA5-data-download" title="Permalink to this headline">¶</a></h1>
<p>ERA5 is downloaded using the monthly means for single levels <code class="docutils literal notranslate"><span class="pre">reanalysis-era5-single-levels-monthly-means</span></code>. The function takes the variables, target months, area and folder. The function downloads the data on a 1x1 degree grid, similar to the SEAS5 data. The default dataset is 0.25 x 0.25 (so higher resolution data is available).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">retrieve_ERA5</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span>
                  <span class="n">folder</span><span class="p">,</span>
                  <span class="n">grid</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                  <span class="n">target_months</span><span class="o">=</span><span class="p">[</span>
                      <span class="s1">&#39;01&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;02&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;03&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;04&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;05&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;06&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;07&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;08&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;09&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;10&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;11&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;12&#39;</span><span class="p">,</span>
                  <span class="p">],</span>
                  <span class="n">area</span><span class="o">=</span><span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the full ERA5 dataset from CDS (years 1979-2020).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables : The variables to be downloaded, str. Can also be one variable.</span>
<span class="sd">        folder : The path to the folder where to store the data.</span>
<span class="sd">        grid : The grid spacing, or spatial resolution of the data.</span>
<span class="sd">            Defaults to 1x1 degrees to match SEAS5.</span>
<span class="sd">            If a higher resolution is wanted, use [0.25, 0.25].</span>
<span class="sd">        target_months : The month(s) of interest.</span>
<span class="sd">            For example, for JJA, use [6,7,8].</span>
<span class="sd">            Defaults to all months.</span>
<span class="sd">        area : The domain to download the data over, [North, West, South, East,].</span>
<span class="sd">            For example, to dowload longitude 30,70 and latitude -10, 120, use [70, -11, 30, 120,].</span>
<span class="sd">            Default is the full extent [90, -180, -90, 180].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Saves the files in the specified folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
        <span class="s1">&#39;reanalysis-era5-single-levels-monthly-means&#39;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span>
            <span class="s1">&#39;netcdf&#39;</span><span class="p">,</span>
            <span class="s1">&#39;product_type&#39;</span><span class="p">:</span>
            <span class="s1">&#39;monthly_averaged_reanalysis&#39;</span><span class="p">,</span>
            <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="n">variables</span><span class="p">,</span>
            <span class="s1">&#39;area&#39;</span><span class="p">:</span>     <span class="n">area</span><span class="p">,</span>
            <span class="s1">&#39;grid&#39;</span><span class="p">:</span>     <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;1979&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1980&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1981&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1982&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1983&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1984&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1985&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1986&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1987&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1988&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1989&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1990&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1991&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1992&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1993&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1994&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1995&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1996&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1997&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1998&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1999&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2000&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2001&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2002&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2003&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2004&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2005&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2006&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2007&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2008&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2009&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2010&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2011&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2012&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2013&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2014&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2015&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2016&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2017&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2018&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2019&#39;</span><span class="p">,</span>
                <span class="s1">&#39;2020&#39;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s1">&#39;month&#39;</span><span class="p">:</span>
            <span class="n">target_months</span><span class="p">,</span>
            <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="s1">&#39;00:00&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;ERA5_1x1.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">retrieve_SEAS5</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">target_months</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">2017</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Retrieve SEAS5 data from CDS.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables : The variables to be downloaded, str. Can also be one variable.</span>
<span class="sd">        target_months : The month(s) of interest, int.</span>
<span class="sd">            For example, for JJA, use [6,7,8].</span>
<span class="sd">            Must be consecutive (e.g. no May, July, August).</span>
<span class="sd">        area : The domain to download the data over, [North, West, South, East,].</span>
<span class="sd">            For example, to dowload longitude 30,70 and latitude -10, 120, use [70, -11, 30, 120,]</span>
<span class="sd">        years : Defaults to the entire hindcast years from 1981-2016</span>
<span class="sd">        folder : The path to the folder where to store the data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Saves the files in the specified folder.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">init_months</span><span class="p">,</span> <span class="n">leadtimes</span> <span class="o">=</span> <span class="n">_get_init_months</span><span class="p">(</span><span class="n">target_months</span><span class="p">)</span>
    <span class="n">init_months_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">init_months</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;112&#39;</span> <span class="ow">in</span> <span class="n">init_months_str</span><span class="p">:</span> <span class="c1">## This means that we are crossing years - both January and December initializations are used.</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_months</span><span class="p">)):</span>
                <span class="n">init_month</span> <span class="o">=</span> <span class="n">init_months</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">leadtime_months</span> <span class="o">=</span> <span class="n">leadtimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="mi">12</span> <span class="ow">in</span> <span class="n">init_months</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">init_month</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">year</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">year</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">year</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.2i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">init_month</span> <span class="o">+</span> <span class="s1">&#39;.nc&#39;</span><span class="p">):</span>
                    <span class="n">_retrieve_single</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span>
                                    <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span>
                                    <span class="n">init_month</span><span class="o">=</span><span class="n">init_month</span><span class="p">,</span>
                                    <span class="n">leadtimes</span><span class="o">=</span><span class="n">leadtime_months</span><span class="p">,</span>
                                    <span class="n">area</span> <span class="o">=</span> <span class="n">area</span><span class="p">,</span>
                                    <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Timo Kelder

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>