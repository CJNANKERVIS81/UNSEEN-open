%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{times}
\expandafter\ifx\csname T@LGR\endcsname\relax
\else
% LGR was declared as font encoding
  \substitutefont{LGR}{\rmdefault}{cmr}
  \substitutefont{LGR}{\sfdefault}{cmss}
  \substitutefont{LGR}{\ttdefault}{cmtt}
\fi
\expandafter\ifx\csname T@X2\endcsname\relax
  \expandafter\ifx\csname T@T2A\endcsname\relax
  \else
  % T2A was declared as font encoding
    \substitutefont{T2A}{\rmdefault}{cmr}
    \substitutefont{T2A}{\sfdefault}{cmss}
    \substitutefont{T2A}{\ttdefault}{cmtt}
  \fi
\else
% X2 was declared as font encoding
  \substitutefont{X2}{\rmdefault}{cmr}
  \substitutefont{X2}{\sfdefault}{cmss}
  \substitutefont{X2}{\ttdefault}{cmtt}
\fi


\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Introduction:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}


% Jupyter Notebook code cell colors
\definecolor{nbsphinxin}{HTML}{307FC1}
\definecolor{nbsphinxout}{HTML}{BF5B3D}
\definecolor{nbsphinx-code-bg}{HTML}{F5F5F5}
\definecolor{nbsphinx-code-border}{HTML}{E0E0E0}
\definecolor{nbsphinx-stderr}{HTML}{FFDDDD}
% ANSI colors for output streams and traceback highlighting
\definecolor{ansi-black}{HTML}{3E424D}
\definecolor{ansi-black-intense}{HTML}{282C36}
\definecolor{ansi-red}{HTML}{E75C58}
\definecolor{ansi-red-intense}{HTML}{B22B31}
\definecolor{ansi-green}{HTML}{00A250}
\definecolor{ansi-green-intense}{HTML}{007427}
\definecolor{ansi-yellow}{HTML}{DDB62B}
\definecolor{ansi-yellow-intense}{HTML}{B27D12}
\definecolor{ansi-blue}{HTML}{208FFB}
\definecolor{ansi-blue-intense}{HTML}{0065CA}
\definecolor{ansi-magenta}{HTML}{D160C4}
\definecolor{ansi-magenta-intense}{HTML}{A03196}
\definecolor{ansi-cyan}{HTML}{60C6C8}
\definecolor{ansi-cyan-intense}{HTML}{258F8F}
\definecolor{ansi-white}{HTML}{C5C1B4}
\definecolor{ansi-white-intense}{HTML}{A1A6B2}
\definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
\definecolor{ansi-default-inverse-bg}{HTML}{000000}

% Define an environment for non-plain-text code cell outputs (e.g. images)
\makeatletter
\newenvironment{nbsphinxfancyoutput}{%
    % Avoid fatal error with framed.sty if graphics too long to fit on one page
    \let\sphinxincludegraphics\nbsphinxincludegraphics
    \nbsphinx@image@maxheight\textheight
    \advance\nbsphinx@image@maxheight -2\fboxsep   % default \fboxsep 3pt
    \advance\nbsphinx@image@maxheight -2\fboxrule  % default \fboxrule 0.4pt
    \advance\nbsphinx@image@maxheight -\baselineskip
\def\nbsphinxfcolorbox{\spx@fcolorbox{nbsphinx-code-border}{white}}%
\def\FrameCommand{\nbsphinxfcolorbox\nbsphinxfancyaddprompt\@empty}%
\def\FirstFrameCommand{\nbsphinxfcolorbox\nbsphinxfancyaddprompt\sphinxVerbatim@Continues}%
\def\MidFrameCommand{\nbsphinxfcolorbox\sphinxVerbatim@Continued\sphinxVerbatim@Continues}%
\def\LastFrameCommand{\nbsphinxfcolorbox\sphinxVerbatim@Continued\@empty}%
\MakeFramed{\advance\hsize-\width\@totalleftmargin\z@\linewidth\hsize\@setminipage}%
\lineskip=1ex\lineskiplimit=1ex\raggedright%
}{\par\unskip\@minipagefalse\endMakeFramed}
\makeatother
\newbox\nbsphinxpromptbox
\def\nbsphinxfancyaddprompt{\ifvoid\nbsphinxpromptbox\else
    \kern\fboxrule\kern\fboxsep
    \copy\nbsphinxpromptbox
    \kern-\ht\nbsphinxpromptbox\kern-\dp\nbsphinxpromptbox
    \kern-\fboxsep\kern-\fboxrule\nointerlineskip
    \fi}
\newlength\nbsphinxcodecellspacing
\setlength{\nbsphinxcodecellspacing}{0pt}

% Define support macros for attaching opening and closing lines to notebooks
\newsavebox\nbsphinxbox
\makeatletter
\newcommand{\nbsphinxstartnotebook}[1]{%
    \par
    % measure needed space
    \setbox\nbsphinxbox\vtop{{#1\par}}
    % reserve some space at bottom of page, else start new page
    \needspace{\dimexpr2.5\baselineskip+\ht\nbsphinxbox+\dp\nbsphinxbox}
    % mimick vertical spacing from \section command
      \addpenalty\@secpenalty
      \@tempskipa 3.5ex \@plus 1ex \@minus .2ex\relax
      \addvspace\@tempskipa
      {\Large\@tempskipa\baselineskip
             \advance\@tempskipa-\prevdepth
             \advance\@tempskipa-\ht\nbsphinxbox
             \ifdim\@tempskipa>\z@
               \vskip \@tempskipa
             \fi}
    \unvbox\nbsphinxbox
    % if notebook starts with a \section, prevent it from adding extra space
    \@nobreaktrue\everypar{\@nobreakfalse\everypar{}}%
    % compensate the parskip which will get inserted by next paragraph
    \nobreak\vskip-\parskip
    % do not break here
    \nobreak
}% end of \nbsphinxstartnotebook

\newcommand{\nbsphinxstopnotebook}[1]{%
    \par
    % measure needed space
    \setbox\nbsphinxbox\vbox{{#1\par}}
    \nobreak % it updates page totals
    \dimen@\pagegoal
    \advance\dimen@-\pagetotal \advance\dimen@-\pagedepth
    \advance\dimen@-\ht\nbsphinxbox \advance\dimen@-\dp\nbsphinxbox
    \ifdim\dimen@<\z@
      % little space left
      \unvbox\nbsphinxbox
      \kern-.8\baselineskip
      \nobreak\vskip\z@\@plus1fil
      \penalty100
      \vskip\z@\@plus-1fil
      \kern.8\baselineskip
    \else
      \unvbox\nbsphinxbox
    \fi
}% end of \nbsphinxstopnotebook

% Ensure height of an included graphics fits in nbsphinxfancyoutput frame
\newdimen\nbsphinx@image@maxheight % set in nbsphinxfancyoutput environment
\newcommand*{\nbsphinxincludegraphics}[2][]{%
    \gdef\spx@includegraphics@options{#1}%
    \setbox\spx@image@box\hbox{\includegraphics[#1,draft]{#2}}%
    \in@false
    \ifdim \wd\spx@image@box>\linewidth
      \g@addto@macro\spx@includegraphics@options{,width=\linewidth}%
      \in@true
    \fi
    % no rotation, no need to worry about depth
    \ifdim \ht\spx@image@box>\nbsphinx@image@maxheight
      \g@addto@macro\spx@includegraphics@options{,height=\nbsphinx@image@maxheight}%
      \in@true
    \fi
    \ifin@
      \g@addto@macro\spx@includegraphics@options{,keepaspectratio}%
    \fi
    \setbox\spx@image@box\box\voidb@x % clear memory
    \expandafter\includegraphics\expandafter[\spx@includegraphics@options]{#2}%
}% end of "\MakeFrame"-safe variant of \sphinxincludegraphics
\makeatother

\makeatletter
\renewcommand*\sphinx@verbatim@nolig@list{\do\'\do\`}
\begingroup
\catcode`'=\active
\let\nbsphinx@noligs\@noligs
\g@addto@macro\nbsphinx@noligs{\let'\PYGZsq}
\endgroup
\makeatother
\renewcommand*\sphinxbreaksbeforeactivelist{\do\<\do\"\do\'}
\renewcommand*\sphinxbreaksafteractivelist{\do\.\do\,\do\:\do\;\do\?\do\!\do\/\do\>\do\-}
\makeatletter
\fvset{codes*=\sphinxbreaksattexescapedchars\do\^\^\let\@noligs\nbsphinx@noligs}
\makeatother



\title{unseen\_open}
\date{Sep 17, 2020}
\release{}
\author{Timo Kelder}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}



\chapter{What is UNSEEN?}
\label{\detokenize{Whats-unseen:What-is-UNSEEN?}}\label{\detokenize{Whats-unseen::doc}}
The UNprecedented Simulated Extreme ENsemble (UNSEEN, \sphinxhref{https://www.nature.com/articles/s41467-017-00275-3}{Thompson et al., 2017}) approach is an increasingly popular method that exploits seasonal prediction systems to \sphinxstylestrong{assess and anticipate climate extremes beyond the observed record}. The approach uses pooled forecasts as plausible alternate realities. Instead of the ‘single realization’ of reality, pooled forecasts can be exploited to better assess the likelihood of infrequent events,
which only have a limited chance of occurring in observed records. This method has for example been used to improve design levels of storm\sphinxhyphen{}surges in the river Rhine and to anticipate and understand heatwaves in China.

Recently, we applied this method to SEAS5 for the first time, with promising results for extreme precipitation over Norway and Svalbard (submitted to \sphinxhref{https://doi.org/10.31223/osf.io/hyxeq}{NPJ Climate and Atmospheric Science}). SEAS5 is a good dataset for the UNSEEN approach because it is freely available and has a high resolution and a large ensemble compared to global climate models. To make this approach more accessible, we develop an open, reproducible and transferable workflow for the
UNSEEN method using the open access SEAS5 dataset on the CDS.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[ ]:\,\hspace{\fboxrule}\hspace{\fboxsep}}
\end{sphinxVerbatim}
}


\chapter{UNSEEN\sphinxhyphen{}open}
\label{\detokenize{Notebooks/Workflow:UNSEEN-open}}\label{\detokenize{Notebooks/Workflow::doc}}
In this project, the aim is to build an open, reproducible, and transferable workflow for UNSEEN. The workflow consists of four steps, as illustrated below:

\sphinxincludegraphics[width=1347\sphinxpxdimen,height=806\sphinxpxdimen]{{Workflow}.png}

In this project, UNSEEN\sphinxhyphen{}open is applied to assess two extreme events in 2020: February 2020 UK precipitation and the 2020 Siberian heatwave.

February average precipitation was the highest on record in the UK: with what frequency of occurrence can February extreme precipitation events such as the 2020 event be expected?

The Siberian heatwave has broken the records as well. Could such an event be anticipation with UNSEEN? And to what extend can we expect changes in the frequency of occurrence and magnitude of these kind of events?


\section{Overview}
\label{\detokenize{Notebooks/Workflow:Overview}}
Here we provide an overview of the steps taken to apply UNSEEN\sphinxhyphen{}open.


\subsection{Download}
\label{\detokenize{Notebooks/Workflow:Download}}
We want to download February precipitation over the UK and March\sphinxhyphen{}May average temperature over Siberia. We retrieve all SEAS5 seasonal forecasts that are forecasting the target months (i.e. February and MAM) and we retrieve ERA5 reanalysis for the same regions and variables for evaluation.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[1]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{n}{sys}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{abspath}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{abspath}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[2]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k+kn}{import} \PYG{n+nn}{src}\PYG{n+nn}{.}\PYG{n+nn}{cdsretrieve} \PYG{k}{as} \PYG{n+nn}{retrieve}
\PYG{k+kn}{import} \PYG{n+nn}{src}\PYG{n+nn}{.}\PYG{n+nn}{preprocess} \PYG{k}{as} \PYG{n+nn}{preprocess}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{variables} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}dewpoint\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,}
         \PYG{n}{area} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{]}\PYG{p}{,} \PYG{n}{years}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1981}\PYG{p}{,} \PYG{l+m+mi}{2021}\PYG{p}{)}\PYG{p}{,} \PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
2020-09-16 12:42:52,756 INFO Welcome to the CDS
2020-09-16 12:42:52,758 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:42:55,461 INFO Request is queued
2020-09-16 12:43:44,892 INFO Request is completed
2020-09-16 12:43:44,895 INFO Downloading http://136.156.133.41/cache-compute-0013/cache/data1/adaptor.mars.external-1600256610.5590868-10484-1-43f9f2fc-9209-4306-ba84-5fc2f56c8cbb.nc to ../Siberia\_example/SEAS5/201702.nc (3.2M)
2020-09-16 12:43:45,155 INFO Download rate 12.3M/s
2020-09-16 12:43:46,261 INFO Welcome to the CDS
2020-09-16 12:43:46,263 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:43:47,913 INFO Request is queued
2020-09-16 12:43:52,712 INFO Request is running
2020-09-16 12:44:01,189 INFO Request is completed
2020-09-16 12:44:01,191 INFO Downloading http://136.156.132.198/cache-compute-0003/cache/data3/adaptor.mars.external-1600256631.4983242-12958-16-44a30635-2276-47c7-9a9c-312b21ba1879.nc to ../Siberia\_example/SEAS5/201701.nc (3.2M)
2020-09-16 12:44:01,333 INFO Download rate 22.3M/s
2020-09-16 12:44:03,029 INFO Welcome to the CDS
2020-09-16 12:44:03,031 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:44:04,786 INFO Request is queued
2020-09-16 12:44:18,071 INFO Request is running
2020-09-16 12:44:25,689 INFO Request is completed
2020-09-16 12:44:25,691 INFO Downloading http://136.156.132.210/cache-compute-0005/cache/data4/adaptor.mars.external-1600256656.8702655-11521-21-84570425-df1d-45cf-ae6a-2f220e1f1c62.nc to ../Siberia\_example/SEAS5/201612.nc (1.6M)
2020-09-16 12:44:25,780 INFO Download rate 17.7M/s
2020-09-16 12:44:27,551 INFO Welcome to the CDS
2020-09-16 12:44:27,552 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:44:29,188 INFO Request is queued
2020-09-16 12:45:18,630 INFO Request is completed
2020-09-16 12:45:18,631 INFO Downloading http://136.156.133.46/cache-compute-0015/cache/data1/adaptor.mars.external-1600256707.239661-17582-21-c50e6007-95da-4019-9324-d423e1862177.nc to ../Siberia\_example/SEAS5/201802.nc (3.2M)
2020-09-16 12:45:18,775 INFO Download rate 22.4M/s
2020-09-16 12:45:19,725 INFO Welcome to the CDS
2020-09-16 12:45:19,726 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:45:21,293 INFO Request is queued
2020-09-16 12:45:42,197 INFO Request is running
2020-09-16 12:45:53,616 INFO Request is completed
2020-09-16 12:45:53,618 INFO Downloading http://136.156.132.110/cache-compute-0001/cache/data2/adaptor.mars.external-1600256736.302646-2916-7-906ebfa9-4208-4d26-9642-9090ea44be6e.nc to ../Siberia\_example/SEAS5/201801.nc (3.2M)
2020-09-16 12:45:53,784 INFO Download rate 19.1M/s
2020-09-16 12:45:56,421 INFO Welcome to the CDS
2020-09-16 12:45:56,423 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:45:58,590 INFO Request is queued
2020-09-16 12:46:30,897 INFO Request is completed
2020-09-16 12:46:30,898 INFO Downloading http://136.156.133.36/cache-compute-0010/cache/data1/adaptor.mars.external-1600256780.4346173-24644-14-b7e1baa7-a597-484a-ad07-4704018026fc.nc to ../Siberia\_example/SEAS5/201712.nc (3.2M)
2020-09-16 12:46:31,063 INFO Download rate 19.3M/s
2020-09-16 12:46:32,348 INFO Welcome to the CDS
2020-09-16 12:46:32,349 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:46:33,083 INFO Request is queued
2020-09-16 12:47:22,511 INFO Request is running
2020-09-16 12:47:48,182 INFO Request is completed
2020-09-16 12:47:48,184 INFO Downloading http://136.156.133.39/cache-compute-0012/cache/data9/adaptor.mars.external-1600256837.9028022-8098-12-c831d16e-b859-42cf-b5be-ef68bfe6d486.nc to ../Siberia\_example/SEAS5/201902.nc (3.2M)
2020-09-16 12:47:48,334 INFO Download rate 21.3M/s
2020-09-16 12:47:49,241 INFO Welcome to the CDS
2020-09-16 12:47:49,243 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:47:52,161 INFO Request is queued
2020-09-16 12:48:41,595 INFO Request is running
2020-09-16 12:49:07,268 INFO Request is completed
2020-09-16 12:49:07,269 INFO Downloading http://136.156.133.42/cache-compute-0014/cache/data5/adaptor.mars.external-1600256919.2350588-1054-28-68c7f028-c6c0-4e48-acf8-123db9b7fa2e.nc to ../Siberia\_example/SEAS5/201901.nc (3.2M)
2020-09-16 12:49:07,419 INFO Download rate 21.4M/s
2020-09-16 12:49:08,744 INFO Welcome to the CDS
2020-09-16 12:49:08,747 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:49:10,318 INFO Request is queued
2020-09-16 12:49:23,593 INFO Request is running
2020-09-16 12:49:31,209 INFO Request is completed
2020-09-16 12:49:31,210 INFO Downloading http://136.156.132.110/cache-compute-0001/cache/data7/adaptor.mars.external-1600256959.9121842-3051-15-ae0c3334-05f6-4503-a76a-9e94b580d344.nc to ../Siberia\_example/SEAS5/201812.nc (3.2M)
2020-09-16 12:49:31,323 INFO Download rate 27.9M/s
2020-09-16 12:49:32,568 INFO Welcome to the CDS
2020-09-16 12:49:32,569 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:49:33,136 INFO Request is queued
2020-09-16 12:49:54,013 INFO Request is running
2020-09-16 12:50:05,432 INFO Request is completed
2020-09-16 12:50:05,434 INFO Downloading http://136.156.133.25/cache-compute-0008/cache/data5/adaptor.mars.external-1600256989.3033717-31909-16-4100686f-0c78-4337-bb28-9ec75058c74b.nc to ../Siberia\_example/SEAS5/202002.nc (3.2M)
2020-09-16 12:50:05,610 INFO Download rate 18.1M/s
2020-09-16 12:50:05,797 INFO Welcome to the CDS
2020-09-16 12:50:05,798 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:50:06,347 INFO Request is queued
2020-09-16 12:50:11,146 INFO Request is running
2020-09-16 12:50:14,540 INFO Request is completed
2020-09-16 12:50:14,542 INFO Downloading http://136.156.132.105/cache-compute-0000/cache/data9/adaptor.mars.external-1600257009.4601834-28351-14-4b0c98c4-0453-42a5-b214-f96628f6588f.nc to ../Siberia\_example/SEAS5/202001.nc (3.2M)
2020-09-16 12:50:14,741 INFO Download rate 16M/s
2020-09-16 12:50:15,321 INFO Welcome to the CDS
2020-09-16 12:50:15,323 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-09-16 12:50:15,528 INFO Request is queued
2020-09-16 12:50:16,546 INFO Request is running
2020-09-16 12:50:23,771 INFO Request is completed
2020-09-16 12:50:23,773 INFO Downloading http://136.156.132.105/cache-compute-0000/cache/data5/adaptor.mars.external-1600257016.6044283-28180-19-953e8ab1-ad1d-459a-b87e-881b25166155.nc to ../Siberia\_example/SEAS5/201912.nc (3.2M)
2020-09-16 12:50:23,920 INFO Download rate 21.7M/s
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[4]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{variables} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}precipitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
         \PYG{n}{area} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}ERA5}\PYG{p}{(}\PYG{n}{variables} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}dewpoint\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,}
         \PYG{n}{area} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{]}\PYG{p}{,} \PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/ERA5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}ERA5}\PYG{p}{(}\PYG{n}{variables} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}precipitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
         \PYG{n}{area} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/ERA5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}


\subsection{Preprocess}
\label{\detokenize{Notebooks/Workflow:Preprocess}}
In the preprocessing step, we first merge all downloaded files into one netcdf file. Then the rest of the preprocessing depends on the definition of the extreme event. For example, for the UK case study, we want to extract the UK average precipitation while for the Siberian heatwave we will just used the defined area to spatially average over. For the MAM season, we still need to take the seasonal average, while for the UK we already have the average February precipitation.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[7]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia} \PYG{o}{=} \PYG{n}{preprocess}\PYG{o}{.}\PYG{n}{merge\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}Siberia}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Lead time: 02
1
12
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[7]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 41, leadtime: 3, longitude: 132, number: 51, time: 117)
Coordinates:
  * number     (number) int64 0 1 2 3 4 5 6 7 8 9 {\ldots} 42 43 44 45 46 47 48 49 50
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} 118.0 119.0 120.0
  * latitude   (latitude) float32 70.0 69.0 68.0 67.0 {\ldots} 33.0 32.0 31.0 30.0
  * time       (time) datetime64[ns] 1982-03-01 1982-04-01 {\ldots} 2020-05-01
  * leadtime   (leadtime) int64 2 3 4
Data variables:
    t2m        (leadtime, time, number, latitude, longitude) float32 dask.array<chunksize=(1, 3, 51, 41, 132), meta=np.ndarray>
    d2m        (leadtime, time, number, latitude, longitude) float32 dask.array<chunksize=(1, 3, 51, 41, 132), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 09:33:24 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{latitude} \PYG{o}{=} \PYG{l+m+mi}{60}\PYG{p}{,} \PYG{n}{longitude} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{time} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2000\PYGZhy{}03}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{number} \PYG{o}{=} \PYG{l+m+mi}{24}\PYG{p}{,} \PYG{n}{leadtime} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{)}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (time: 1)
Coordinates:
    longitude  float32 -10.0
    number     int32 24
  * time       (time) datetime64[ns] 2000-03-01
    latitude   float32 60.0
    leadtime   int64 3
Data variables:
    t2m        (time) float32 279.34442
    d2m        (time) float32 275.4092
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 09:33:24 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK} \PYG{o}{=} \PYG{n}{preprocess}\PYG{o}{.}\PYG{n}{merge\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}UK}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Lead time: 1
12
11
10
9
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 11, leadtime: 5, longitude: 14, number: 25, time: 35)
Coordinates:
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} -1.0 0.0 1.0 2.0
  * number     (number) int32 0 1 2 3 4 5 6 7 8 9 {\ldots} 16 17 18 19 20 21 22 23 24
  * latitude   (latitude) float32 60.0 59.0 58.0 57.0 {\ldots} 53.0 52.0 51.0 50.0
  * time       (time) datetime64[ns] 1982-02-01 1983-02-01 {\ldots} 2016-02-01
  * leadtime   (leadtime) int64 2 3 4 5 6
Data variables:
    tprate     (time, number, latitude, longitude) float32 dask.array<chunksize=(1, 25, 11, 14), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-05-13 14:48:38 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[ ]:\,\hspace{\fboxrule}\hspace{\fboxsep}}
\end{sphinxVerbatim}
}


\subsection{Read more}
\label{\detokenize{Notebooks/Workflow:Read-more}}
Jump into the respective sections for more detail:
\begin{itemize}
\item {} 
\sphinxstylestrong{Download}
\begin{itemize}
\item {} 
{\hyperref[\detokenize{Notebooks/1.Download/1.Retrieve::doc}]{\sphinxcrossref{\DUrole{doc}{1. Retrieve}}}}

\end{itemize}

\item {} 
\sphinxstylestrong{Pre\sphinxhyphen{}process}
\begin{itemize}
\item {} 
2.1 Merge

\item {} 
\sphinxhref{2.Preprocess/2.2Mask.ipynb}{2.2 Mask}

\item {} 
2.3 Upscale

\end{itemize}

\item {} 
\sphinxstylestrong{Evaluate}
\begin{itemize}
\item {} 
{\hyperref[\detokenize{Notebooks/3.Evaluate/3.Evaluate::doc}]{\sphinxcrossref{\DUrole{doc}{3. Evaluate}}}}

\end{itemize}

\item {} 
\sphinxstylestrong{Illustrate}

\end{itemize}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[ ]:\,\hspace{\fboxrule}\hspace{\fboxsep}}
\end{sphinxVerbatim}
}


\chapter{Examples}
\label{\detokenize{Notebooks/Examples:Examples}}\label{\detokenize{Notebooks/Examples::doc}}
In this project, UNSEEN\sphinxhyphen{}open is applied to assess two extreme events in 2020: February 2020 UK precipitation and the 2020 Siberian heatwave. The required steps to perform this analysis is illustrated here, detailed information can be found under ‘Workflow’.


\section{Siberian Heatwave}
\label{\detokenize{Notebooks/Examples:Siberian-Heatwave}}
The 2020 Siberian heatwave has broken the records. Could such an event be anticipation with UNSEEN? And to what extend can we expect changes in the frequency of occurrence and magnitude of these kind of events?


\subsection{Download}
\label{\detokenize{Notebooks/Examples:Download}}
The main functions to retrieve all forecasts (SEAS5) and reanalysis (ERA5) are \sphinxcode{\sphinxupquote{retrieve\_SEAS5}} and \sphinxcode{\sphinxupquote{retrieve\_ERA5}}. We want to download 2m temperature, for the March\sphinxhyphen{}May target months over the Siberian domain. By default, the hindcast years of 1981\sphinxhyphen{}2016 are downloaded for SEAS5. We include the years 1981\sphinxhyphen{}2020. The folder indicates where the files will be stored, in this case outside of the UNSEEN\sphinxhyphen{}open repository, in a ‘Siberia\_example’ directory. For more explanation, see
{\hyperref[\detokenize{Notebooks/1.Download/1.Retrieve::doc}]{\sphinxcrossref{\DUrole{doc}{retrieve}}}}.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[2]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}SEAS5}\PYG{p}{(}
    \PYG{n}{variables}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}dewpoint\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{target\PYGZus{}months}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{area}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{]}\PYG{p}{,}
    \PYG{n}{years}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1981}\PYG{p}{,} \PYG{l+m+mi}{2021}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{folder}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[3]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}ERA5}\PYG{p}{(}\PYG{n}{variables}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2m\PYGZus{}dewpoint\PYGZus{}temperature}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                       \PYG{n}{target\PYGZus{}months}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{,}
                       \PYG{n}{area}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{]}\PYG{p}{,}
                       \PYG{n}{folder}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/ERA5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}


\subsection{Preprocess}
\label{\detokenize{Notebooks/Examples:Preprocess}}
In the preprocessing step, we first merge all downloaded files into one xarray dataset, then take the spatial average over the domain and a temporal average over the MAM season. Read the docs on {\hyperref[\detokenize{Notebooks/2.Preprocess/2.Preprocess::doc}]{\sphinxcrossref{\DUrole{doc}{preprocessing}}}} For more info.

The merged xarray dataset looks like this:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[4]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia} \PYG{o}{=} \PYG{n}{preprocess}\PYG{o}{.}\PYG{n}{merge\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}Siberia}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Lead time: 02
1
12
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[4]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 41, leadtime: 3, longitude: 132, number: 51, time: 117)
Coordinates:
  * number     (number) int64 0 1 2 3 4 5 6 7 8 9 {\ldots} 42 43 44 45 46 47 48 49 50
  * latitude   (latitude) float32 70.0 69.0 68.0 67.0 {\ldots} 33.0 32.0 31.0 30.0
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} 118.0 119.0 120.0
  * time       (time) datetime64[ns] 1982-03-01 1982-04-01 {\ldots} 2020-05-01
  * leadtime   (leadtime) int64 2 3 4
Data variables:
    t2m        (leadtime, time, number, latitude, longitude) float32 dask.array<chunksize=(1, 3, 51, 41, 132), meta=np.ndarray>
    d2m        (leadtime, time, number, latitude, longitude) float32 dask.array<chunksize=(1, 3, 51, 41, 132), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 09:33:24 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

And for ERA5:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ERA5\PYGZus{}Siberia} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}mfdataset}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/ERA5/ERA5\PYGZus{}????.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{combine}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{by\PYGZus{}coords}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} open the data}
\PYG{n}{ERA5\PYGZus{}Siberia}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 41, longitude: 132, time: 126)
Coordinates:
  * latitude   (latitude) float32 70.0 69.0 68.0 67.0 {\ldots} 33.0 32.0 31.0 30.0
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} 118.0 119.0 120.0
  * time       (time) datetime64[ns] 1979-03-01 1979-04-01 {\ldots} 2020-05-01
Data variables:
    t2m        (time, latitude, longitude) float32 dask.array<chunksize=(3, 41, 132), meta=np.ndarray>
    d2m        (time, latitude, longitude) float32 dask.array<chunksize=(3, 41, 132), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 13:26:08 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

Then we calculate the day\sphinxhyphen{}in\sphinxhyphen{}month weighted seasonal average:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{preprocess}\PYG{o}{.}\PYG{n}{season\PYGZus{}mean}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}Siberia}\PYG{p}{,} \PYG{n}{years} \PYG{o}{=} \PYG{l+m+mi}{39}\PYG{p}{)}
\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{preprocess}\PYG{o}{.}\PYG{n}{season\PYGZus{}mean}\PYG{p}{(}\PYG{n}{ERA5\PYGZus{}Siberia}\PYG{p}{,} \PYG{n}{years} \PYG{o}{=} \PYG{l+m+mi}{42}\PYG{p}{)}
\end{sphinxVerbatim}
}

And we select the 2m temperature, and take the average over a further specified domain. This is a simple average, a area\sphinxhyphen{}weighed average is more appropriate, since grid cell area decreases with latitude, see {\hyperref[\detokenize{Notebooks/2.Preprocess/2.Preprocess::doc}]{\sphinxcrossref{\DUrole{doc}{preprocess}}}}.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[7]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}weighted}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{t2m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}
        \PYG{n}{latitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{longitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{65}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}
    \PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
}


\section{UK Precipitation}
\label{\detokenize{Notebooks/Examples:UK-Precipitation}}
February average precipitation was the highest on record in the UK: with what frequency of occurrence can February extreme precipitation events such as the 2020 event be expected?

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}ERA5}\PYG{p}{(}\PYG{n}{variables}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}precipitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                       \PYG{n}{target\PYGZus{}months}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
                       \PYG{n}{area}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
                       \PYG{n}{folder}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/ERA5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[4]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{retrieve\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{variables}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}precipitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                        \PYG{n}{target\PYGZus{}months}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
                        \PYG{n}{area}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{60}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,}
                        \PYG{n}{folder}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK} \PYG{o}{=} \PYG{n}{preprocess}\PYG{o}{.}\PYG{n}{merge\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}UK}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Lead time: 1
12
11
10
9
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 11, leadtime: 5, longitude: 14, number: 25, time: 35)
Coordinates:
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} -1.0 0.0 1.0 2.0
  * number     (number) int32 0 1 2 3 4 5 6 7 8 9 {\ldots} 16 17 18 19 20 21 22 23 24
  * latitude   (latitude) float32 60.0 59.0 58.0 57.0 {\ldots} 53.0 52.0 51.0 50.0
  * time       (time) datetime64[ns] 1982-02-01 1983-02-01 {\ldots} 2016-02-01
  * leadtime   (leadtime) int64 2 3 4 5 6
Data variables:
    tprate     (time, number, latitude, longitude) float32 dask.array<chunksize=(1, 25, 11, 14), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-05-13 14:48:38 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[ ]:\,\hspace{\fboxrule}\hspace{\fboxsep}}
\end{sphinxVerbatim}
}


\subsection{Read more}
\label{\detokenize{Notebooks/Examples:Read-more}}
Jump into the respective sections for more detail:
\begin{itemize}
\item {} 
\sphinxstylestrong{Download}
\begin{itemize}
\item {} 
{\hyperref[\detokenize{Notebooks/1.Download/1.Retrieve::doc}]{\sphinxcrossref{\DUrole{doc}{1. Retrieve}}}}

\end{itemize}

\item {} 
\sphinxstylestrong{Pre\sphinxhyphen{}process}
\begin{itemize}
\item {} 
2.1 Merge

\item {} 
\sphinxhref{2.Preprocess/2.2Mask.ipynb}{2.2 Mask}

\item {} 
2.3 Upscale

\end{itemize}

\item {} 
\sphinxstylestrong{Evaluate}
\begin{itemize}
\item {} 
{\hyperref[\detokenize{Notebooks/3.Evaluate/3.Evaluate::doc}]{\sphinxcrossref{\DUrole{doc}{3. Evaluate}}}}

\end{itemize}

\item {} 
\sphinxstylestrong{Illustrate}

\end{itemize}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[ ]:\,\hspace{\fboxrule}\hspace{\fboxsep}}
\end{sphinxVerbatim}
}


\chapter{Retrieve}
\label{\detokenize{Notebooks/1.Download/1.Retrieve:Retrieve}}\label{\detokenize{Notebooks/1.Download/1.Retrieve::doc}}
We want to download the monthly precipitation for February. I use the automatically generated request from the CDS server. There are two datasets we can use to download the data: \sphinxhref{https://cds.climate.copernicus.eu/cdsapp\#!/dataset/seasonal-original-single-levels?tab=form}{Seasonal forecast daily data on single levels} and \sphinxhref{https://cds.climate.copernicus.eu/cdsapp\#!/dataset/seasonal-monthly-single-levels?tab=form}{Seasonal forecast monthly statistics on single levels}. We will use the
latter for easy downloading of the monthly values. If we want to go to higher temporal resolution, such as daily extremes, we will have to consult the other dataset.

To get started with CDS, you have to register at \sphinxurl{https://cds.climate.copernicus.eu/} and copy your UID and API key from \sphinxurl{https://cds.climate.copernicus.eu/user} in the \sphinxcode{\sphinxupquote{\textasciitilde{}/.cdsapirc}} file in the home directory of your user. See the \sphinxhref{https://nbviewer.jupyter.org/github/esowc/ml\_flood/blob/master/notebooks/1\_data\_download\_analysis\_visualization/1.01\_cdsapi\_setup.ipynb}{ml\sphinxhyphen{}flood project} for more details

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[7]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{UID} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{UID}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{API\PYGZus{}key} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{API\PYGZus{}key}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{c+c1}{\PYGZsh{}Uncomment the following lines to write the UID and API key in the .cdsapirc file}
\PYG{c+c1}{\PYGZsh{} with open(os.path.join(os.path.expanduser(\PYGZsq{}\PYGZti{}\PYGZsq{}), \PYGZsq{}.cdsapirc\PYGZsq{}), \PYGZsq{}w\PYGZsq{}) as f:}
\PYG{c+c1}{\PYGZsh{}     f.write(\PYGZsq{}url: https://cds.climate.copernicus.eu/api/v2\PYGZbs{}n\PYGZsq{})}
\PYG{c+c1}{\PYGZsh{}     f.write(f\PYGZsq{}key: \PYGZob{}UID\PYGZcb{}:\PYGZob{}API\PYGZus{}key\PYGZcb{}\PYGZsq{})}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}46
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}47
\end{sphinxVerbatim}
}


\section{Import packages}
\label{\detokenize{Notebooks/1.Download/1.Retrieve:Import-packages}}
{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[100]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}This is so variables get printed within jupyter}
\PYG{k+kn}{from} \PYG{n+nn}{IPython}\PYG{n+nn}{.}\PYG{n+nn}{core}\PYG{n+nn}{.}\PYG{n+nn}{interactiveshell} \PYG{k+kn}{import} \PYG{n}{InteractiveShell}
\PYG{n}{InteractiveShell}\PYG{o}{.}\PYG{n}{ast\PYGZus{}node\PYGZus{}interactivity} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{all}\PYG{l+s+s2}{\PYGZdq{}}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[9]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}import packages}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{cdsapi} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} check the current working directory, which should be the UNSEEN\PYGZhy{}open directory}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{xarray} \PYG{k}{as} \PYG{n+nn}{xr}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}\PYG{n+nn}{.}\PYG{n+nn}{crs} \PYG{k}{as} \PYG{n+nn}{ccrs}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[3]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}We want the working directory to be the UNSEEN\PYGZhy{}open directory}
\PYG{n}{pwd} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{}current working directory is UNSEEN\PYGZhy{}open/Notebooks/1.Download}
\PYG{n}{pwd} \PYG{c+c1}{\PYGZsh{}print the present working directory}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{n}{pwd}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/../../}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} Change the working directory to UNSEEN\PYGZhy{}open}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}print the working directory}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[3]:\,\hspace{\fboxrule}\hspace{\fboxsep}}'/lustre/soge1/projects/ls/personal/timo/UNSEEN-open/Notebooks/1.Download'
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[3]:\,\hspace{\fboxrule}\hspace{\fboxsep}}'/lustre/soge1/projects/ls/personal/timo/UNSEEN-open'
\end{sphinxVerbatim}
}


\section{First download}
\label{\detokenize{Notebooks/1.Download/1.Retrieve:First-download}}
In our request, we will use the monthly mean. Interestingly, there is also the option to use the monthly maximum! We previously downloaded the data on daily resolution and extracted the monthly (or seasonal) maximum from that data. If we could just download the monthly maximum instead that might save a lot of processing power! However, you would be restricted to daily extremes only, for multi\sphinxhyphen{}day extremes (5 days is often used), you would have to do the original processing workflow. We select
the UK domain to reduce the size of the download.

Here I download the monthly mean total precipitation (both convective and large scale precipitation) forecast for February 1993. It downloads all 25 ensemble members for the forecasts initialized in january.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[4]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}Our first download:}

\PYG{n}{c} \PYG{o}{=} \PYG{n}{cdsapi}\PYG{o}{.}\PYG{n}{Client}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{c}\PYG{o}{.}\PYG{n}{retrieve}\PYG{p}{(}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{seasonal\PYGZhy{}monthly\PYGZhy{}single\PYGZhy{}levels}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{format}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{netcdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{originating\PYGZus{}centre}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ecmwf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{system}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{variable}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}precipitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{product\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{monthly\PYGZus{}mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{c+c1}{\PYGZsh{}\PYGZsq{}monthly\PYGZus{}maximum\PYGZsq{},, \PYGZsq{}monthly\PYGZus{}standard\PYGZus{}deviation\PYGZsq{},}
        \PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{c+c1}{\PYGZsh{}data before 1993 is available.}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{01}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{c+c1}{\PYGZsh{}Initialization month. Target month is February (2), initialization months are August\PYGZhy{}January (8\PYGZhy{}12,1)}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{leadtime\PYGZus{}month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[} \PYG{c+c1}{\PYGZsh{}\PYGZsh{}Use of single months is much faster. Leadtime 0 does not exist. The first lead time is 1.}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{p}{]}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{area}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}Select UK domain to reduce the size of the download}
            \PYG{l+m+mi}{60}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,}
            \PYG{l+m+mi}{2}\PYG{p}{,}
        \PYG{p}{]}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/First\PYGZus{}download.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{}can I use nc? yes!}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
2020-05-13 10:08:56,140 INFO Welcome to the CDS
2020-05-13 10:08:56,142 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-05-13 10:08:56,983 INFO Request is completed
2020-05-13 10:08:56,984 INFO Downloading http://136.156.132.110/cache-compute-0001/cache/data0/adaptor.mars.external-1589266964.5635436-26283-29-a38e8975-b0ec-49ee-8f9b-7dea389f59cf.nc to Data/First\_download.nc (16.4K)
2020-05-13 10:08:57,131 INFO Download rate 112.7K/s
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[4]:\,\hspace{\fboxrule}\hspace{\fboxsep}}Result(content\_length=16800,content\_type=application/x-netcdf,location=http://136.156.132.110/cache-compute-0001/cache/data0/adaptor.mars.external-1589266964.5635436-26283-29-a38e8975-b0ec-49ee-8f9b-7dea389f59cf.nc)
\end{sphinxVerbatim}
}


\subsection{Use xarray to visualize the netcdf file}
\label{\detokenize{Notebooks/1.Download/1.Retrieve:Use-xarray-to-visualize-the-netcdf-file}}
I open the downloaded file and plot February 1993 precipitation over the UK.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{pr\PYGZus{}1993\PYGZus{}ds}\PYG{o}{=}\PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/First\PYGZus{}download.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{pr\PYGZus{}1993\PYGZus{}ds}

\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 11, longitude: 14, number: 25, time: 2)
Coordinates:
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} -1.0 0.0 1.0 2.0
  * latitude   (latitude) float32 60.0 59.0 58.0 57.0 {\ldots} 53.0 52.0 51.0 50.0
  * number     (number) int32 0 1 2 3 4 5 6 7 8 9 {\ldots} 16 17 18 19 20 21 22 23 24
  * time       (time) datetime64[ns] 1993-01-01 1993-02-01
Data variables:
    tprate     (time, number, latitude, longitude) float32 {\ldots}
Attributes:
    Conventions:  CF-1.6
    history:      2020-05-12 07:02:45 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

I select ensemble member 0 and february precipitation (‘tprate’ called apparently) and I use cartopy to make the map.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}\PYGZsh{} Use cartopy for nicer maps}
\PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{axes}\PYG{p}{(}\PYG{n}{projection}\PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{OSGB}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{pr\PYGZus{}1993\PYGZus{}ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tprate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{number}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993\PYGZhy{}02}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{transform}\PYG{o}{=}\PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{},cmap=plt.cm.Blues,}

\PYG{c+c1}{\PYGZsh{} ax.set\PYGZus{}extent(extent)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{coastlines}\PYG{p}{(}\PYG{n}{resolution}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{50m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{draw}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.QuadMesh at 0x7f5435adfa60>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<cartopy.mpl.feature\_artist.FeatureArtist at 0x7f5435b6ff10>
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=247\sphinxpxdimen,height=247\sphinxpxdimen]{{Notebooks_1.Download_1.Retrieve_12_2}.png}

\end{nbsphinxfancyoutput}


\subsection{Download all data}
\label{\detokenize{Notebooks/1.Download/1.Retrieve:Download-all-data}}
We will be using the SEAS5 hindcast, which is a dataset running from 1981\sphinxhyphen{}2016. The hindcast is initialized every month with 25 ensemble members and the forecast run for 6 months, indicated by blue horizontal bars below. February is forecasted by 6 initialization months (September\sphinxhyphen{}February). We discard the first month of the forecast because of dependence between the forecasts, explained in the evaluation section and are left with 5 initialization months (Sep\sphinxhyphen{}Jan) and 25 ensemble members
forecasting february precipitation each year, totalling to an increase of 125 times the observed length.

For a summary of all available C3S seasonal hindcasts, their initialization months and more specifics, please see \sphinxhref{https://confluence.ecmwf.int/display/CKB/C3S+Seasonal+Forecasts}{ECMWF page} and the \sphinxhref{https://doi.org/10.5194/gmd-12-1087-2019}{SEAS5 paper}.

\sphinxincludegraphics{{Notebooks/1.Download/../../graphs/Data_illustration}.png}

The first download example above downloaded all 25 ensemble members for the forecast initialized in January (the bottom bar). We should repeat this over the other initialization month and over all years (1981\sphinxhyphen{}2016).

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{init\PYGZus{}months} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{9}\PYG{p}{,}\PYG{l+m+mi}{13}\PYG{p}{)}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} Initialization months 9\PYGZhy{}12,1 (Sep\PYGZhy{}Jan)}
\PYG{n}{init\PYGZus{}months}
\PYG{n}{years} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1982}\PYG{p}{,}\PYG{l+m+mi}{2017}\PYG{p}{)}
\PYG{n}{years}

\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}array([ 9, 10, 11, 12,  1])
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}array([1982, 1983, 1984, 1985, 1986, 1987, 1988, 1989, 1990, 1991, 1992,
       1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003,
       2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014,
       2015, 2016])
\end{sphinxVerbatim}
}

For our download, we loop over initialization months and years. Because we only want February precipitation, the leadtime month (forecast length) changes with the initialization month. For example, in the September initialized forecasts, we only want the leadtime month 6 = February. For August initialized this is leadtime 5, etc. Furthermore, the year the forecast is initialized is required for the download. For September \sphinxhyphen{} December initialized forecasts, this is the target year\sphinxhyphen{}1. For January
it is the same year as the target year. For example, for the first two target years this looks like the following:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[101]:\,\hspace{\fboxrule}\hspace{\fboxsep}}
\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}\PYG{c+c1}{\PYGZsh{}len(years)):}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{init\PYGZus{}months}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{init\PYGZus{}month} \PYG{o}{=} \PYG{n}{init\PYGZus{}months}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
        \PYG{n}{leadtime\PYGZus{}month} \PYG{o}{=} \PYG{l+m+mi}{6}\PYG{o}{\PYGZhy{}}\PYG{n}{i}
        \PYG{k}{if} \PYG{n}{init\PYGZus{}month} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{:}
            \PYG{n}{year} \PYG{o}{=} \PYG{n}{years}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{year} \PYG{o}{=} \PYG{n}{years}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}
        \PYG{n+nb}{print} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year = }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ init\PYGZus{}month = }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{init\PYGZus{}month}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ leadtime\PYGZus{}month = }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{leadtime\PYGZus{}month}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
year = 1981 init\_month = 9 leadtime\_month = 6
year = 1981 init\_month = 10 leadtime\_month = 5
year = 1981 init\_month = 11 leadtime\_month = 4
year = 1981 init\_month = 12 leadtime\_month = 3
year = 1982 init\_month = 1 leadtime\_month = 2
year = 1982 init\_month = 9 leadtime\_month = 6
year = 1982 init\_month = 10 leadtime\_month = 5
year = 1982 init\_month = 11 leadtime\_month = 4
year = 1982 init\_month = 12 leadtime\_month = 3
year = 1983 init\_month = 1 leadtime\_month = 2
\end{sphinxVerbatim}
}

Write a function that is used for the download.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[72]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k}{def} \PYG{n+nf}{retrieve}\PYG{p}{(}\PYG{n}{variable}\PYG{p}{,} \PYG{n}{originating\PYGZus{}centre}\PYG{p}{,} \PYG{n}{year}\PYG{p}{,} \PYG{n}{init\PYGZus{}month}\PYG{p}{,} \PYG{n}{leadtime\PYGZus{}month}\PYG{p}{)}\PYG{p}{:}

    \PYG{n}{c}\PYG{o}{.}\PYG{n}{retrieve}\PYG{p}{(}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{seasonal\PYGZhy{}monthly\PYGZhy{}single\PYGZhy{}levels}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{p}{\PYGZob{}}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{format}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{netcdf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{originating\PYGZus{}centre}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{originating\PYGZus{}centre}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{system}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{variable}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{variable}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{product\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}
                \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{monthly\PYGZus{}mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{c+c1}{\PYGZsh{}\PYGZsq{}monthly\PYGZus{}maximum\PYGZsq{},, \PYGZsq{}monthly\PYGZus{}standard\PYGZus{}deviation\PYGZsq{},}
            \PYG{p}{]}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)}\PYG{p}{,} \PYG{c+c1}{\PYGZsh{}data before 1993 is available.}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZpc{}.2i}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{init\PYGZus{}month}\PYG{p}{,} \PYG{c+c1}{\PYGZsh{}Initialization month. Target month is February (2), initialization months are August\PYGZhy{}January (8\PYGZhy{}12,1)}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{leadtime\PYGZus{}month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[} \PYG{c+c1}{\PYGZsh{}\PYGZsh{}The lead times you want. Use of single months is much faster. Leadtime 0 does not exist. The first lead time is 1.}
                \PYG{c+c1}{\PYGZsh{}For initialization month 1 (January), the leadtime months is 2 (February). For initialization month 12 (december), the lead time month is 3 (February).}
                \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{leadtime\PYGZus{}month}\PYG{p}{)}\PYG{p}{,}
            \PYG{p}{]}\PYG{p}{,}
            \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{area}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{p}{[}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}Select UK domain to reduce the size of the download}
                     \PYG{c+c1}{\PYGZsh{}\PYGZsh{} 25N\PYGZhy{}75N x. 40W\PYGZhy{}75E}
                \PYG{l+m+mi}{60}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,}
            \PYG{p}{]}\PYG{p}{,}
        \PYG{p}{\PYGZcb{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{year}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZpc{}.2i}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{init\PYGZus{}month} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} retrieve(variable = \PYGZsq{}total\PYGZus{}precipitation\PYGZsq{},originating\PYGZus{}centre = \PYGZsq{}ecmwf\PYGZsq{}, year = years[0], init\PYGZus{}month = \PYGZdq{}\PYGZpc{}.2i\PYGZdq{} \PYGZpc{} init\PYGZus{}months[0])}
\end{sphinxVerbatim}
}

And start the download! In total, we request 35 years x initialization dates = 175 requests. I could try sending just 5 request of the different initialization dates for all years?

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[ ]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{years}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{}\PYGZsh{}add if error still continue}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{init\PYGZus{}months}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{init\PYGZus{}month} \PYG{o}{=} \PYG{n}{init\PYGZus{}months}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
        \PYG{n}{leadtime\PYGZus{}month} \PYG{o}{=} \PYG{l+m+mi}{6} \PYG{o}{\PYGZhy{}} \PYG{n}{i}
        \PYG{k}{if} \PYG{n}{init\PYGZus{}month} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{:}
            \PYG{n}{year} \PYG{o}{=} \PYG{n}{years}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{year} \PYG{o}{=} \PYG{n}{years}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{1}
        \PYG{n}{retrieve}\PYG{p}{(}\PYG{n}{variable}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}precipitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                 \PYG{n}{originating\PYGZus{}centre}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ecmwf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                 \PYG{n}{year}\PYG{o}{=}\PYG{n}{year}\PYG{p}{,}
                 \PYG{n}{init\PYGZus{}month}\PYG{o}{=}\PYG{n}{init\PYGZus{}month}\PYG{p}{,}
                 \PYG{n}{leadtime\PYGZus{}month}\PYG{o}{=}\PYG{n}{leadtime\PYGZus{}month}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
2020-05-18 10:14:48,767 INFO Welcome to the CDS
2020-05-18 10:14:48,768 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-05-18 10:14:49,485 INFO Downloading http://136.156.132.235/cache-compute-0006/cache/data5/adaptor.mars.external-1589380912.7108843-4209-7-1add31ae-a0cd-44ce-83ac-9ff7c97f1b01.nc to ../UK\_example/198109.nc (8.9K)
2020-05-18 10:14:49,575 INFO Download rate 101.5K/s
2020-05-18 10:14:49,803 INFO Welcome to the CDS
2020-05-18 10:14:49,804 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-05-18 10:14:50,498 INFO Downloading http://136.156.132.153/cache-compute-0002/cache/data4/adaptor.mars.external-1589381056.172494-12462-1-c9714216-87ac-49bc-be19-260627a9077d.nc to ../UK\_example/198110.nc (8.9K)
2020-05-18 10:14:50,571 INFO Download rate 124.6K/s
2020-05-18 10:14:51,070 INFO Welcome to the CDS
2020-05-18 10:14:51,071 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-05-18 10:14:51,213 INFO Downloading http://136.156.132.235/cache-compute-0006/cache/data9/adaptor.mars.external-1589381301.6300867-8112-3-49ba0ab2-34fe-4364-9dec-700bf911b079.nc to ../UK\_example/198111.nc (8.9K)
2020-05-18 10:14:51,254 INFO Download rate 219.7K/s
2020-05-18 10:14:51,415 INFO Welcome to the CDS
2020-05-18 10:14:51,416 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-05-18 10:14:51,548 INFO Request is queued
\end{sphinxVerbatim}
}

The download sometimes fails. When redoing the request it does download. I don’t know what is causing the failure? Below I donwload the file that failed.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[97]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}201501 missing}

\PYG{n}{year} \PYG{o}{=} \PYG{l+m+mi}{2015}
\PYG{n}{init\PYGZus{}month} \PYG{o}{=} \PYG{l+m+mi}{1}
\PYG{n}{leadtime\PYGZus{}month} \PYG{o}{=} \PYG{l+m+mi}{2}
\PYG{n}{retrieve}\PYG{p}{(}\PYG{n}{variable} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{total\PYGZus{}precipitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{originating\PYGZus{}centre} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ecmwf}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{year} \PYG{o}{=} \PYG{n}{year}\PYG{p}{,}
                 \PYG{n}{init\PYGZus{}month} \PYG{o}{=} \PYG{n}{init\PYGZus{}month}\PYG{p}{,} \PYG{n}{leadtime\PYGZus{}month} \PYG{o}{=} \PYG{n}{leadtime\PYGZus{}month}\PYG{p}{)}


\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
2020-05-15 11:51:16,127 INFO Welcome to the CDS
2020-05-15 11:51:16,129 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/seasonal-monthly-single-levels
2020-05-15 11:51:16,327 INFO Downloading http://136.156.133.46/cache-compute-0015/cache/data7/adaptor.mars.external-1589527607.2123153-8094-37-3b786f72-2e2a-462f-bbb8-9c8d89c05102.nc to ../UK\_example/201501.nc (8.9K)
2020-05-15 11:51:16,485 INFO Download rate 56.7K/s
\end{sphinxVerbatim}
}


\subsection{EOBS data download}
\label{\detokenize{Notebooks/1.Download/1.Retrieve:EOBS-data-download}}
I tried to download EOBS through CDS, but the Product is temporally disabled for maintenance purposes (see below). As workaround I downloaded EOBS (from 1950 \sphinxhyphen{} 2019) and the most recent EOBS data (2020) \sphinxhref{https://surfobs.climate.copernicus.eu/dataaccess/access\_eobs.php}{here}. Note, you have to register as E\sphinxhyphen{}OBS user.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[99]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{c}\PYG{o}{.}\PYG{n}{retrieve}\PYG{p}{(}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{insitu\PYGZhy{}gridded\PYGZhy{}observations\PYGZhy{}europe}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{version}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{v20.0e}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{format}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{zip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{product\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ensemble\PYGZus{}mean}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{variable}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{precipitation\PYGZus{}amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{grid\PYGZus{}resolution}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{0\PYGZus{}25}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{full\PYGZus{}period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/EOBS/EOBS.zip}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
2020-05-15 14:06:44,721 INFO Welcome to the CDS
2020-05-15 14:06:44,722 INFO Sending request to https://cds.climate.copernicus.eu/api/v2/resources/insitu-gridded-observations-europe
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\textcolor{ansi-red}{---------------------------------------------------------------------------}
\textcolor{ansi-red}{HTTPError}                                 Traceback (most recent call last)
\textcolor{ansi-green}{\textasciitilde{}/.conda/envs/UNSEEN-open/lib/python3.8/site-packages/cdsapi/api.py} in \textcolor{ansi-cyan}{\_api}\textcolor{ansi-blue}{(self, url, request, method)}
\textcolor{ansi-green-intense}{\textbf{    388}}         \textcolor{ansi-green}{try}\textcolor{ansi-blue}{:}
\textcolor{ansi-green}{--> 389}\textcolor{ansi-red}{             }result\textcolor{ansi-blue}{.}raise\_for\_status\textcolor{ansi-blue}{(}\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    390}}             reply \textcolor{ansi-blue}{=} result\textcolor{ansi-blue}{.}json\textcolor{ansi-blue}{(}\textcolor{ansi-blue}{)}

\textcolor{ansi-green}{\textasciitilde{}/.conda/envs/UNSEEN-open/lib/python3.8/site-packages/requests/models.py} in \textcolor{ansi-cyan}{raise\_for\_status}\textcolor{ansi-blue}{(self)}
\textcolor{ansi-green-intense}{\textbf{    940}}         \textcolor{ansi-green}{if} http\_error\_msg\textcolor{ansi-blue}{:}
\textcolor{ansi-green}{--> 941}\textcolor{ansi-red}{             }\textcolor{ansi-green}{raise} HTTPError\textcolor{ansi-blue}{(}http\_error\_msg\textcolor{ansi-blue}{,} response\textcolor{ansi-blue}{=}self\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    942}}

\textcolor{ansi-red}{HTTPError}: 403 Client Error:  for url: https://cds.climate.copernicus.eu/api/v2/resources/insitu-gridded-observations-europe

During handling of the above exception, another exception occurred:

\textcolor{ansi-red}{Exception}                                 Traceback (most recent call last)
\textcolor{ansi-green}{<ipython-input-99-d12768b41b79>} in \textcolor{ansi-cyan}{<module>}
\textcolor{ansi-green}{----> 1}\textcolor{ansi-red}{ c.retrieve(
}\textcolor{ansi-green-intense}{\textbf{      2}}     \textcolor{ansi-blue}{'insitu-gridded-observations-europe'}\textcolor{ansi-blue}{,}
\textcolor{ansi-green-intense}{\textbf{      3}}     \{
\textcolor{ansi-green-intense}{\textbf{      4}}         \textcolor{ansi-blue}{'version'}\textcolor{ansi-blue}{:} \textcolor{ansi-blue}{'v20.0e'}\textcolor{ansi-blue}{,}
\textcolor{ansi-green-intense}{\textbf{      5}}         \textcolor{ansi-blue}{'format'}\textcolor{ansi-blue}{:} \textcolor{ansi-blue}{'zip'}\textcolor{ansi-blue}{,}

\textcolor{ansi-green}{\textasciitilde{}/.conda/envs/UNSEEN-open/lib/python3.8/site-packages/cdsapi/api.py} in \textcolor{ansi-cyan}{retrieve}\textcolor{ansi-blue}{(self, name, request, target)}
\textcolor{ansi-green-intense}{\textbf{    315}}
\textcolor{ansi-green-intense}{\textbf{    316}}     \textcolor{ansi-green}{def} retrieve\textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{,} name\textcolor{ansi-blue}{,} request\textcolor{ansi-blue}{,} target\textcolor{ansi-blue}{=}\textcolor{ansi-green}{None}\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{:}
\textcolor{ansi-green}{--> 317}\textcolor{ansi-red}{         }result \textcolor{ansi-blue}{=} self\textcolor{ansi-blue}{.}\_api\textcolor{ansi-blue}{(}\textcolor{ansi-blue}{'\%s/resources/\%s'} \textcolor{ansi-blue}{\%} \textcolor{ansi-blue}{(}self\textcolor{ansi-blue}{.}url\textcolor{ansi-blue}{,} name\textcolor{ansi-blue}{)}\textcolor{ansi-blue}{,} request\textcolor{ansi-blue}{,} \textcolor{ansi-blue}{'POST'}\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    318}}         \textcolor{ansi-green}{if} target \textcolor{ansi-green}{is} \textcolor{ansi-green}{not} \textcolor{ansi-green}{None}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{    319}}             result\textcolor{ansi-blue}{.}download\textcolor{ansi-blue}{(}target\textcolor{ansi-blue}{)}

\textcolor{ansi-green}{\textasciitilde{}/.conda/envs/UNSEEN-open/lib/python3.8/site-packages/cdsapi/api.py} in \textcolor{ansi-cyan}{\_api}\textcolor{ansi-blue}{(self, url, request, method)}
\textcolor{ansi-green-intense}{\textbf{    408}}                                  "of '\%s' at \%s" \% (t['title'], t['url']))
\textcolor{ansi-green-intense}{\textbf{    409}}                     error \textcolor{ansi-blue}{=} \textcolor{ansi-blue}{'. '}\textcolor{ansi-blue}{.}join\textcolor{ansi-blue}{(}e\textcolor{ansi-blue}{)}
\textcolor{ansi-green}{--> 410}\textcolor{ansi-red}{                 }\textcolor{ansi-green}{raise} Exception\textcolor{ansi-blue}{(}error\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{    411}}             \textcolor{ansi-green}{else}\textcolor{ansi-blue}{:}
\textcolor{ansi-green-intense}{\textbf{    412}}                 \textcolor{ansi-green}{raise}

\textcolor{ansi-red}{Exception}: Product temporally disabled for maintenance purposes. Sorry for the inconvenience, please try again later.
\end{sphinxVerbatim}
}


\chapter{Preprocess}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Preprocess}}\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess::doc}}
The preprocessing steps consist of merging all retrieved files into one xarray dataset and extracting the spatial and temporal average of the event of interest.


\section{Merge}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Merge}}
Here it is shown how all retrieved files are loaded into one xarray dataset, for both SEAS5 and for ERA5.


\subsection{SEAS5}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:SEAS5}}
All retrieved seasonal forecasts are loaded into one xarray dataset. The amount of files retrieved depends on the temporal extent of the extreme event that is being analyzed (i.e are you looking at a monthly average or a seasonal average?). For the Siberian heatwave, we have retrieved 105 files (one for each of the 35 years and for each of the three lead times, ({\hyperref[\detokenize{Notebooks/1.Download/1.Retrieve::doc}]{\sphinxcrossref{\DUrole{doc}{see Retrieve}}}}). For the UK, we are able to use more forecasts, because the target month is shorter:
one month as compared to three months for the Siberian example. We retrieved 5 leadtimes x 35 = 125 files.

Each netcdf file contains 25 ensemble members, hence has the dimensions lat, lon, number (25 ensembles). Here we create an xarray dataset that also contains the dimensions time (35 years) and leadtime (5 initialization months). To generate this, we loop over lead times, and open all 35 years of the lead time and then concatenate those leadtimes.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[1]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}This is so variables get printed within jupyter}
\PYG{k+kn}{from} \PYG{n+nn}{IPython}\PYG{n+nn}{.}\PYG{n+nn}{core}\PYG{n+nn}{.}\PYG{n+nn}{interactiveshell} \PYG{k+kn}{import} \PYG{n}{InteractiveShell}
\PYG{n}{InteractiveShell}\PYG{o}{.}\PYG{n}{ast\PYGZus{}node\PYGZus{}interactivity} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{all}\PYG{l+s+s2}{\PYGZdq{}}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[2]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{n}{sys}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{abspath}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../../}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{src}\PYG{n+nn}{.}\PYG{n+nn}{cdsretrieve} \PYG{k}{as} \PYG{n+nn}{retrieve}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{os}\PYG{o}{.}\PYG{n}{chdir}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{abspath}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../../}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{os}\PYG{o}{.}\PYG{n}{getcwd}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}print the working directory}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}'/lustre/soge1/projects/ls/personal/timo/UNSEEN-open'
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[6]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k+kn}{import} \PYG{n+nn}{xarray} \PYG{k}{as} \PYG{n+nn}{xr}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}

\PYG{k}{def} \PYG{n+nf}{merge\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{folder}\PYG{p}{,} \PYG{n}{target\PYGZus{}months}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{init\PYGZus{}months}\PYG{p}{,} \PYG{n}{leadtimes} \PYG{o}{=} \PYG{n}{retrieve}\PYG{o}{.}\PYG{n}{\PYGZus{}get\PYGZus{}init\PYGZus{}months}\PYG{p}{(}\PYG{n}{target\PYGZus{}months}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lead time: }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZpc{}.2i}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{init\PYGZus{}months}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{SEAS5\PYGZus{}ld1} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}mfdataset}\PYG{p}{(}
        \PYG{n}{folder} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZpc{}.2i}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{init\PYGZus{}months}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{combine}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{by\PYGZus{}coords}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Load the first lead time}
    \PYG{n}{SEAS5} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}ld1}  \PYG{c+c1}{\PYGZsh{} Create the xarray dataset to concatenate over}
    \PYG{k}{for} \PYG{n}{init\PYGZus{}month} \PYG{o+ow}{in} \PYG{n}{init\PYGZus{}months}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{init\PYGZus{}months}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{}\PYGZsh{} Remove the first that we already have}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{init\PYGZus{}month}\PYG{p}{)}
        \PYG{n}{SEAS5\PYGZus{}ld} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}mfdataset}\PYG{p}{(}
            \PYG{n}{folder} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{*}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZpc{}.2i}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{\PYGZpc{}} \PYG{n}{init\PYGZus{}month} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{n}{combine}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{by\PYGZus{}coords}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{SEAS5} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{p}{[}\PYG{n}{SEAS5}\PYG{p}{,} \PYG{n}{SEAS5\PYGZus{}ld}\PYG{p}{]}\PYG{p}{,} \PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{leadtime}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{SEAS5} \PYG{o}{=} \PYG{n}{SEAS5}\PYG{o}{.}\PYG{n}{assign\PYGZus{}coords}\PYG{p}{(}\PYG{n}{leadtime} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{init\PYGZus{}months}\PYG{p}{)}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mi}{2}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} assign leadtime coordinates}
    \PYG{k}{return}\PYG{p}{(}\PYG{n}{SEAS5}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[7]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia} \PYG{o}{=} \PYG{n}{merge\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{folder}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                            \PYG{n}{target\PYGZus{}months}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Lead time: 02
1
12
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 41, leadtime: 3, longitude: 132, number: 51, time: 117)
Coordinates:
  * time       (time) datetime64[ns] 1982-03-01 1982-04-01 {\ldots} 2020-05-01
  * latitude   (latitude) float32 70.0 69.0 68.0 67.0 {\ldots} 33.0 32.0 31.0 30.0
  * number     (number) int64 0 1 2 3 4 5 6 7 8 9 {\ldots} 42 43 44 45 46 47 48 49 50
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} 118.0 119.0 120.0
  * leadtime   (leadtime) int64 2 3 4
Data variables:
    t2m        (leadtime, time, number, latitude, longitude) float32 dask.array<chunksize=(1, 3, 51, 41, 132), meta=np.ndarray>
    d2m        (leadtime, time, number, latitude, longitude) float32 dask.array<chunksize=(1, 3, 51, 41, 132), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 09:33:24 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

You can for example select a the lat, long, time, ensemble member and lead time as follows (add \sphinxcode{\sphinxupquote{.load()}} to see the values):

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[29]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{a} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}Siberia}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{latitude}\PYG{o}{=}\PYG{l+m+mi}{60}\PYG{p}{,}
                  \PYG{n}{longitude}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{10}\PYG{p}{,}
                  \PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2000\PYGZhy{}03}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{number}\PYG{o}{=}\PYG{l+m+mi}{26}\PYG{p}{,}
                  \PYG{n}{leadtime}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{a}
\PYG{n}{a}\PYG{o}{*}\PYG{l+m+mf}{0.3}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[29]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (time: 1)
Coordinates:
  * time       (time) datetime64[ns] 2000-03-01
    latitude   float32 60.0
    number     int64 26
    longitude  float32 -10.0
    leadtime   int64 3
Data variables:
    t2m        (time) float32 nan
    d2m        (time) float32 nan
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 09:33:24 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[29]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (time: 1)
Coordinates:
  * time       (time) datetime64[ns] 2000-03-01
    leadtime   int64 3
    latitude   float32 60.0
    number     int64 26
    longitude  float32 -10.0
Data variables:
    t2m        (time) float32 nan
    d2m        (time) float32 nan
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 09:33:24 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK} \PYG{o}{=} \PYG{n}{merge\PYGZus{}SEAS5}\PYG{p}{(}\PYG{n}{folder} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/SEAS5/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{target\PYGZus{}months} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Lead time: 01
12
11
10
9
\end{sphinxVerbatim}
}

The SEAS5 total precipitation rate is in m/s. You can easily convert this and change the attributes. Click on the show/hide attributes button to see the assigned attributes.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[11]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tprate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}UK}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tprate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{*} \PYG{l+m+mi}{1000} \PYG{o}{*} \PYG{l+m+mi}{3600} \PYG{o}{*} \PYG{l+m+mi}{24} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} From m/s to mm/d}
\PYG{n}{SEAS5\PYGZus{}UK}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tprate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rainfall}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
 \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mm/day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
 \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{standard\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{thickness\PYGZus{}of\PYGZus{}rainfall\PYGZus{}amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{SEAS5\PYGZus{}UK}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[11]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 11, leadtime: 5, longitude: 14, number: 25, time: 35)
Coordinates:
  * time       (time) datetime64[ns] 1982-02-01 1983-02-01 {\ldots} 2016-02-01
  * latitude   (latitude) float32 60.0 59.0 58.0 57.0 {\ldots} 53.0 52.0 51.0 50.0
  * number     (number) int32 0 1 2 3 4 5 6 7 8 9 {\ldots} 16 17 18 19 20 21 22 23 24
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} -1.0 0.0 1.0 2.0
  * leadtime   (leadtime) int64 2 3 4 5 6
Data variables:
    tprate     (leadtime, time, number, latitude, longitude) float32 dask.array<chunksize=(1, 1, 25, 11, 14), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-05-13 14:49:43 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}


\subsection{ERA5}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:ERA5}}
For each year a netcdf file is downloaded. They are named ERA5\_yyyy, for example ERA5\_1981. Therefore, we can load ERA5 by combining all downloaded years:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[12]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ERA5\PYGZus{}Siberia} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}mfdataset}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../Siberia\PYGZus{}example/ERA5/ERA5\PYGZus{}????.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{combine}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{by\PYGZus{}coords}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} open the data}
\PYG{n}{ERA5\PYGZus{}Siberia}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[12]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 41, longitude: 132, time: 126)
Coordinates:
  * latitude   (latitude) float32 70.0 69.0 68.0 67.0 {\ldots} 33.0 32.0 31.0 30.0
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} 118.0 119.0 120.0
  * time       (time) datetime64[ns] 1979-03-01 1979-04-01 {\ldots} 2020-05-01
Data variables:
    t2m        (time, latitude, longitude) float32 dask.array<chunksize=(3, 41, 132), meta=np.ndarray>
    d2m        (time, latitude, longitude) float32 dask.array<chunksize=(3, 41, 132), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 13:26:08 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[13]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ERA5\PYGZus{}UK} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}mfdataset}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/ERA5/ERA5\PYGZus{}????.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{combine}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{by\PYGZus{}coords}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} open the data}
\PYG{n}{ERA5\PYGZus{}UK}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[13]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 11, longitude: 14, time: 42)
Coordinates:
  * latitude   (latitude) float32 60.0 59.0 58.0 57.0 {\ldots} 53.0 52.0 51.0 50.0
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} -1.0 0.0 1.0 2.0
  * time       (time) datetime64[ns] 1979-02-01 1980-02-01 {\ldots} 2020-02-01
Data variables:
    tp         (time, latitude, longitude) float32 dask.array<chunksize=(1, 11, 14), meta=np.ndarray>
Attributes:
    Conventions:  CF-1.6
    history:      2020-09-08 13:36:54 GMT by grib\_to\_netcdf-2.16.0: /opt/ecmw{\ldots}
\end{sphinxVerbatim}
}


\section{Event definition}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Event-definition}}

\subsection{Time selection}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Time-selection}}
For the UK, the event of interest is UK February average precipitation. Since we download monthly averages, we do not have to do any preprocessing along the time dimension here. For the Siberian heatwave, we are interested in the March\sphinxhyphen{}May average. Therefore we need to take the seasonal average of the monthly timeseries. We cannot take the simple mean of the three months, because they have a different number of days in the months, see \sphinxhref{http://xarray.pydata.org/en/stable/examples/monthly-means.html}{this
example}. Therefore we take a weighted average:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[14]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{month\PYGZus{}length} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}Siberia}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{days\PYGZus{}in\PYGZus{}month}
\PYG{n}{month\PYGZus{}length}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[14]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray 'days\_in\_month' (time: 117)>
array([31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30,
       31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31,
       30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31,
       31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30,
       31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31,
       30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31,
       31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31, 31, 30, 31])
Coordinates:
  * time     (time) datetime64[ns] 1982-03-01 1982-04-01 {\ldots} 2020-05-01
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[15]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{} Calculate the weights by grouping by \PYGZsq{}time.season\PYGZsq{}.}
\PYG{n}{weights} \PYG{o}{=} \PYG{n}{month\PYGZus{}length}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{/} \PYG{n}{month\PYGZus{}length}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{weights}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[15]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray 'days\_in\_month' (time: 117)>
array([0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652, 0.33695652, 0.32608696, 0.33695652,
       0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652, 0.33695652, 0.32608696, 0.33695652,
       0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652, 0.33695652, 0.32608696, 0.33695652,
       0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652, 0.33695652, 0.32608696, 0.33695652,
       0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652, 0.33695652, 0.32608696, 0.33695652,
       0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652, 0.33695652, 0.32608696, 0.33695652,
       0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652, 0.33695652, 0.32608696, 0.33695652,
       0.33695652, 0.32608696, 0.33695652, 0.33695652, 0.32608696,
       0.33695652, 0.33695652, 0.32608696, 0.33695652, 0.33695652,
       0.32608696, 0.33695652])
Coordinates:
  * time     (time) datetime64[ns] 1982-03-01 1982-04-01 {\ldots} 2020-05-01
    year     (time) int64 1982 1982 1982 1983 1983 {\ldots} 2019 2019 2020 2020 2020
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[16]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{} Test that the sum of the weights for the season is 1.0}
\PYG{n}{np}\PYG{o}{.}\PYG{n}{testing}\PYG{o}{.}\PYG{n}{assert\PYGZus{}allclose}\PYG{p}{(}\PYG{n}{weights}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{l+m+mi}{39}\PYG{p}{)}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} the weight is one for each year}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[30]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{} Calculate the weighted average}
\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}weighted} \PYG{o}{=} \PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}Siberia} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{min\PYGZus{}count} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}weighted}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[30]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 41, leadtime: 3, longitude: 132, number: 51, year: 39)
Coordinates:
  * leadtime   (leadtime) int64 2 3 4
  * latitude   (latitude) float32 70.0 69.0 68.0 67.0 {\ldots} 33.0 32.0 31.0 30.0
  * number     (number) int64 0 1 2 3 4 5 6 7 8 9 {\ldots} 42 43 44 45 46 47 48 49 50
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} 118.0 119.0 120.0
  * year       (year) int64 1982 1983 1984 1985 1986 {\ldots} 2017 2018 2019 2020
Data variables:
    t2m        (year, leadtime, number, latitude, longitude) float64 268.8 {\ldots} 289.9
    d2m        (year, leadtime, number, latitude, longitude) float64 266.1 {\ldots} 286.0
\end{sphinxVerbatim}
}

Or as function:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[31]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k}{def} \PYG{n+nf}{season\PYGZus{}mean}\PYG{p}{(}\PYG{n}{ds}\PYG{p}{,} \PYG{n}{years}\PYG{p}{,} \PYG{n}{calendar}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{standard}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Make a DataArray with the number of days in each month, size = len(time)}
    \PYG{n}{month\PYGZus{}length} \PYG{o}{=} \PYG{n}{ds}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{days\PYGZus{}in\PYGZus{}month}

    \PYG{c+c1}{\PYGZsh{} Calculate the weights by grouping by \PYGZsq{}time.season\PYGZsq{}}
    \PYG{n}{weights} \PYG{o}{=} \PYG{n}{month\PYGZus{}length}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{/} \PYG{n}{month\PYGZus{}length}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Test that the sum of the weights for each season is 1.0}
    \PYG{n}{np}\PYG{o}{.}\PYG{n}{testing}\PYG{o}{.}\PYG{n}{assert\PYGZus{}allclose}\PYG{p}{(}\PYG{n}{weights}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{np}\PYG{o}{.}\PYG{n}{ones}\PYG{p}{(}\PYG{n}{years}\PYG{p}{)}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Calculate the weighted average}
    \PYG{k}{return} \PYG{p}{(}\PYG{n}{ds} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{min\PYGZus{}count} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[33]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{season\PYGZus{}mean}\PYG{p}{(}\PYG{n}{ERA5\PYGZus{}Siberia}\PYG{p}{,} \PYG{n}{years} \PYG{o}{=} \PYG{l+m+mi}{42}\PYG{p}{)}
\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}weighted}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[33]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.Dataset>
Dimensions:    (latitude: 41, longitude: 132, year: 42)
Coordinates:
  * latitude   (latitude) float32 70.0 69.0 68.0 67.0 {\ldots} 33.0 32.0 31.0 30.0
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} 118.0 119.0 120.0
  * year       (year) int64 1979 1980 1981 1982 1983 {\ldots} 2017 2018 2019 2020
Data variables:
    t2m        (year, latitude, longitude) float64 270.5 270.9 {\ldots} 289.1 290.6
    d2m        (year, latitude, longitude) float64 267.1 267.4 {\ldots} 283.5 284.7
\end{sphinxVerbatim}
}

What is the difference between the mean and weighted mean?

Barely visible the difference

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[34]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}weighted}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{t2m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ERA5\PYGZus{}Siberia}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{t2m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[34]:\,\hspace{\fboxrule}\hspace{\fboxsep}}[<matplotlib.lines.Line2D at 0x2aedbb30ca90>]
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[34]:\,\hspace{\fboxrule}\hspace{\fboxsep}}[<matplotlib.lines.Line2D at 0x2aed3bf98b50>]
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=398\sphinxpxdimen,height=262\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_24_2}.png}

\end{nbsphinxfancyoutput}


\subsection{Spatial selection}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Spatial-selection}}
What spatial extent defines the event you are analyzing? For the UK, we are looking at country\sphinxhyphen{}averaged precipitation. For the Siberian heatwave we define a box (30\sphinxhyphen{}70N, \sphinxhyphen{}11\sphinxhyphen{}120E) over which we average the temperature.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[35]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}weighted}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{t2m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}  \PYG{c+c1}{\PYGZsh{} Select 2 metre temperature}
        \PYG{n}{latitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{)}\PYG{p}{,}        \PYG{c+c1}{\PYGZsh{} Select the latitudes}
        \PYG{n}{longitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}    \PYG{c+c1}{\PYGZsh{} Select the longitude}
    \PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}   \PYG{c+c1}{\PYGZsh{} And average}
\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[35]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray 't2m' (year: 42)>
array([277.16074991, 277.03096514, 277.97289103, 277.91908656,
       277.97520289, 277.65083809, 277.41882817, 277.91126484,
       276.91748994, 277.7290794 , 278.77625033, 279.26028161,
       277.8734671 , 277.73297789, 278.05803743, 278.33474762,
       278.8209804 , 277.56676759, 279.12484889, 278.01516085,
       277.87531784, 279.26812975, 278.86348174, 279.10661042,
       278.37979554, 278.49025936, 278.74264131, 278.30305153,
       279.58431666, 279.54500525, 278.82677061, 278.60606811,
       279.51421559, 279.21937005, 278.59269493, 279.92328752,
       279.6721145 , 280.00902662, 279.55917477, 278.99138847,
       279.61443777, 280.41497365])
Coordinates:
  * year     (year) int64 1979 1980 1981 1982 1983 {\ldots} 2016 2017 2018 2019 2020
\end{sphinxVerbatim}
}

In addition to the large domain, we select one more specific domain that faced the highest anomalies, also used \sphinxhref{https://twitter.com/ClimateFlavors/status/1276092906709880837?s=20}{here}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[36]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}weighted}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{t2m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}  \PYG{c+c1}{\PYGZsh{} Select 2 metre temperature}
        \PYG{n}{latitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{)}\PYG{p}{,}        \PYG{c+c1}{\PYGZsh{} Select the latitudes}
        \PYG{n}{longitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{65}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}    \PYG{c+c1}{\PYGZsh{} Select the longitude}
    \PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
}

And we repeat this for the SEAS5 events

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[37]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}weighted}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{t2m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}
        \PYG{n}{latitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{longitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{11}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}
    \PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/soge-home/users/cenv0732/.conda/envs/UNSEEN-open/lib/python3.8/site-packages/xarray/core/nanops.py:142: RuntimeWarning: Mean of empty slice
  return np.nanmean(a, axis=axis, dtype=dtype)
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[37]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray 't2m' (year: 39, leadtime: 3, number: 51)>
array([[[277.70246026, 277.08011538, 277.05805243, {\ldots},          nan,
                  nan,          nan],
        [276.54063304, 277.63527276, 276.53540684, {\ldots},          nan,
                  nan,          nan],
        [276.94382457, 277.22540106, 277.25375804, {\ldots},          nan,
                  nan,          nan]],

       [[276.68638666, 276.64418409, 276.88169219, {\ldots},          nan,
                  nan,          nan],
        [277.06362955, 277.30470221, 276.49967939, {\ldots},          nan,
                  nan,          nan],
        [276.37166345, 276.63563118, 277.05456392, {\ldots},          nan,
                  nan,          nan]],

       [[277.53103277, 277.49691758, 278.32115366, {\ldots},          nan,
                  nan,          nan],
        [277.53911427, 278.11393678, 277.66278741, {\ldots},          nan,
                  nan,          nan],
        [278.24589375, 277.71341079, 277.3067712 , {\ldots},          nan,
                  nan,          nan]],

       {\ldots},

       [[278.78906418, 278.0626699 , 278.09438675, {\ldots}, 278.10947691,
         278.27620377, 278.18620179],
        [278.65929139, 277.33954004, 278.65951576, {\ldots}, 278.22959696,
         278.32163068, 278.94724957],
        [278.90689211, 277.9030209 , 279.13818072, {\ldots}, 278.76767259,
         279.13397914, 277.76992423]],

       [[278.6218426 , 277.95006232, 278.22900254, {\ldots}, 277.56330007,
         277.99480916, 277.66857676],
        [278.39808792, 277.65889255, 277.92266928, {\ldots}, 278.39390445,
         277.90353039, 278.01793147],
        [278.63429219, 278.11630486, 278.58465727, {\ldots}, 277.7081865 ,
         277.73949614, 278.65482764]],

       [[279.28124227, 278.53474142, 278.47436518, {\ldots}, 278.93209185,
         278.11716261, 279.3904762 ],
        [277.77935773, 279.15571385, 279.02168652, {\ldots}, 279.25803913,
         278.8991169 , 278.72803803],
        [278.54721722, 278.25816177, 279.65502139, {\ldots}, 279.01242149,
         278.80174459, 278.23615329]]])
Coordinates:
  * leadtime  (leadtime) int64 2 3 4
  * number    (number) int64 0 1 2 3 4 5 6 7 8 9 {\ldots} 42 43 44 45 46 47 48 49 50
  * year      (year) int64 1982 1983 1984 1985 1986 {\ldots} 2016 2017 2018 2019 2020
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[39]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}weighted}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{t2m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}
        \PYG{n}{latitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{70}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{longitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+m+mi}{65}\PYG{p}{,} \PYG{l+m+mi}{120}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}
    \PYG{n}{mean}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{o}{.}\PYG{n}{load}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[39]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray 't2m' (year: 39, leadtime: 3, number: 51)>
array([[[269.41349502, 267.46724112, 268.92858923, {\ldots},          nan,
                  nan,          nan],
        [267.30541714, 269.45786213, 267.88083134, {\ldots},          nan,
                  nan,          nan],
        [266.70463988, 269.36559057, 267.85380896, {\ldots},          nan,
                  nan,          nan]],

       [[267.65255078, 267.85459971, 267.93397041, {\ldots},          nan,
                  nan,          nan],
        [267.86908721, 269.16875401, 266.25505375, {\ldots},          nan,
                  nan,          nan],
        [267.37705396, 268.0216673 , 269.216725  , {\ldots},          nan,
                  nan,          nan]],

       [[269.11559244, 270.30993792, 268.97992022, {\ldots},          nan,
                  nan,          nan],
        [268.42632866, 270.23730451, 268.14872887, {\ldots},          nan,
                  nan,          nan],
        [269.91675564, 269.37623754, 268.62430776, {\ldots},          nan,
                  nan,          nan]],

       {\ldots},

       [[270.1395106 , 269.2763681 , 269.63408345, {\ldots}, 267.98167445,
         270.99148119, 269.2334804 ],
        [269.47838693, 267.62436995, 270.46814617, {\ldots}, 269.60061317,
         269.2030878 , 270.34174847],
        [271.39762301, 268.06102893, 271.27933216, {\ldots}, 269.56866515,
         270.64943148, 266.36754614]],

       [[269.32829344, 268.54758963, 269.10385302, {\ldots}, 268.03762412,
         269.16690743, 268.41760566],
        [269.09579833, 268.27844902, 268.80430384, {\ldots}, 269.38437353,
         269.58112924, 269.15390309],
        [269.2755198 , 269.28402279, 270.34429505, {\ldots}, 268.05044769,
         269.01128231, 270.09822017]],

       [[271.35447849, 269.73507649, 269.16852164, {\ldots}, 270.77523033,
         268.30803885, 271.87237937],
        [269.33923167, 270.81122764, 269.97102764, {\ldots}, 272.56708782,
         270.69195734, 269.90622653],
        [270.37695877, 269.72247595, 272.524012  , {\ldots}, 270.04026793,
         269.81585811, 267.24061429]]])
Coordinates:
  * leadtime  (leadtime) int64 2 3 4
  * number    (number) int64 0 1 2 3 4 5 6 7 8 9 {\ldots} 42 43 44 45 46 47 48 49 50
  * year      (year) int64 1982 1983 1984 1985 1986 {\ldots} 2016 2017 2018 2019 2020
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[40]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events}\PYG{o}{.}\PYG{n}{to\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/SEAS5\PYGZus{}Siberia\PYGZus{}events.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events}\PYG{o}{.}\PYG{n}{to\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/ERA5\PYGZus{}Siberia\PYGZus{}events.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[41]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{o}{.}\PYG{n}{to\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{o}{.}\PYG{n}{to\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/ERA5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}


\subsection{Pick up from here \sphinxhyphen{}\textgreater{} do for ERA and make EOBS EOPtional}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Pick-up-from-here-->-do-for-ERA-and-make-EOBS-EOPtional}}
From grid to country\sphinxhyphen{}averaged timeseries is more complicated.

Here we show how to best extract areal averaged precipitation and test this for UK precipitation within SEAS5 and EOBS. The code is inspired on Matteo De Felice’s \sphinxhref{http://www.matteodefelice.name/post/aggregating-gridded-data/}{blog} \textendash{} credits to him!

We create a mask for all 241 countries within \sphinxhref{https://regionmask.readthedocs.io/en/stable/\#}{Regionmask}, that has predefined countries from \sphinxhref{http://www.naturalearthdata.com}{Natural Earth datasets} (shapefiles). We use the mask to go from gridded precipitation to country\sphinxhyphen{}averaged timeseries. We select UK, number 31 within the country mask.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[2]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{c+c1}{\PYGZsh{}\PYGZsh{}import packages}
\PYG{k+kn}{import} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{xarray} \PYG{k}{as} \PYG{n+nn}{xr}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}\PYG{n+nn}{.}\PYG{n+nn}{crs} \PYG{k}{as} \PYG{n+nn}{ccrs}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{ticker} \PYG{k}{as} \PYG{n+nn}{mticker}

\PYG{k+kn}{import} \PYG{n+nn}{xesmf} \PYG{k}{as} \PYG{n+nn}{xe}      \PYG{c+c1}{\PYGZsh{} Regridding}
\end{sphinxVerbatim}
}

We load the countries and create a mask for SEAS5 and for EOBS.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[62]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{k+kn}{import} \PYG{n+nn}{regionmask}       \PYG{c+c1}{\PYGZsh{} Masking}

\PYG{n}{countries} \PYG{o}{=} \PYG{n}{regionmask}\PYG{o}{.}\PYG{n}{defined\PYGZus{}regions}\PYG{o}{.}\PYG{n}{natural\PYGZus{}earth}\PYG{o}{.}\PYG{n}{countries\PYGZus{}50}
\PYG{n}{countries}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[62]:\,\hspace{\fboxrule}\hspace{\fboxsep}}241 'Natural Earth Countries: 50m' Regions (http://www.naturalearthdata.com)
ZW ZM YE VN VE V VU UZ UY FSM MH MP VI GU AS PR US GS IO SH PN AI FK KY BM VG TC MS JE GG IM GB AE UA UG TM TR TN TT TO TG TL TH TZ TJ TW SYR CH S SW SR SS SD LK E KR ZA SO SL SB SK SLO SG SL SC RS SN SA ST RSM WS VC LC KN RW RUS RO QA P PL PH PE PY PG PA PW PK OM N KP NG NE NI NZ NU CK NL AW CW NP NR NA MZ MA WS ME MN MD MC MX MU MR M ML MV MY MW MG MK L LT FL LY LR LS LB LV LA KG KW KO KI KE KZ J J J I IS PAL IRL IRQ IRN INDO IND IS HU HN HT GY GW GN GT GD GR GH D GE GM GA F PM WF MF BL PF NC TF AI FIN FJ ET EST ER GQ SV EG EC DO DM DJ GL FO DK CZ CN CY CU HR CI CR DRC CG KM CO CN MO HK CL TD CF CV CA CM KH MM BI BF BG BN BR BW BiH BO BT BJ BZ B BY BB BD BH BS AZ A AU IOT HM NF AU ARM AR AG AO AND DZ AL AF SG AQ SX
\end{sphinxVerbatim}
}

Now we create the mask for the SEAS5 grid. Only one timestep is needed to create the mask. This mask will lateron be used to mask all the timesteps.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[63]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}mask} \PYG{o}{=} \PYG{n}{countries}\PYG{o}{.}\PYG{n}{mask}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}UK}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{leadtime}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{number}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1982}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                            \PYG{n}{lon\PYGZus{}name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                            \PYG{n}{lat\PYGZus{}name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

And create a plot to illustrate what the mask looks like. The mask just indicates for each gridcell what country the gridcell belongs to.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[64]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}mask}
\PYG{n}{SEAS5\PYGZus{}mask}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[64]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray 'region' (latitude: 11, longitude: 14)>
array([[ nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,
         nan,  nan,  nan],
       [ nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  31.,  nan,  nan,
         nan,  nan,  nan],
       [ nan,  nan,  nan,  nan,  31.,  nan,  31.,  31.,  nan,  nan,  nan,
         nan,  nan,  nan],
       [ nan,  nan,  nan,  nan,  nan,  nan,  31.,  31.,  31.,  nan,  nan,
         nan,  nan,  nan],
       [ nan,  nan,  nan,  nan,  nan,  nan,  nan,  31.,  nan,  nan,  nan,
         nan,  nan,  nan],
       [ nan,  nan,  nan, 140.,  31.,  31.,  31.,  31.,  31.,  31.,  nan,
         nan,  nan,  nan],
       [ nan, 140., 140., 140., 140.,  nan,  nan,  nan,  nan,  31.,  31.,
         nan,  nan,  nan],
       [ nan,  nan, 140., 140., 140.,  nan,  nan,  31.,  31.,  31.,  31.,
         31.,  nan,  nan],
       [ nan, 140., 140., 140.,  nan,  nan,  31.,  31.,  31.,  31.,  31.,
         31.,  31.,  nan],
       [ nan,  nan,  nan,  nan,  nan,  nan,  nan,  31.,  31.,  31.,  31.,
         31.,  31., 160.],
       [ nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,  nan,
         nan,  nan, 160.]])
Coordinates:
  * latitude   (latitude) float32 60.0 59.0 58.0 57.0 {\ldots} 53.0 52.0 51.0 50.0
  * longitude  (longitude) float32 -11.0 -10.0 -9.0 -8.0 {\ldots} -1.0 0.0 1.0 2.0
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[64]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.QuadMesh at 0x7f2d0c4dff40>
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=383\sphinxpxdimen,height=266\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_41_2}.png}

\end{nbsphinxfancyoutput}

Now we can extract the UK averaged precipitation within SEAS5 by using the mask index of the UK: \sphinxcode{\sphinxupquote{where(SEAS5\_mask == UK\_index)}}. So we need to find the index of one of the 241 abbreviations. In this case for the UK use ‘GB’. Additionally, if you can’t find a country, use \sphinxcode{\sphinxupquote{countries.regions}} to get the full names of the countries.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{countries}\PYG{o}{.}\PYG{n}{abbrevs}\PYG{o}{.}\PYG{n}{index}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{GB}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}31
\end{sphinxVerbatim}
}

To select the UK average, we select SEAS5 precipitation (tprate), select the gridcells that are within the UK and take the mean over those gridcells. This results in a dataset of February precipitation for 35 years (1981\sphinxhyphen{}2016), with 5 leadtimes and 25 ensemble members.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[65]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK} \PYG{o}{=} \PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}UK}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tprate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
            \PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}mask} \PYG{o}{==} \PYG{l+m+mi}{31}\PYG{p}{)}
            \PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}UK}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\textcolor{ansi-red}{---------------------------------------------------------------------------}
\textcolor{ansi-red}{NameError}                                 Traceback (most recent call last)
\textcolor{ansi-green}{<ipython-input-65-40c5d9d9ecbd>} in \textcolor{ansi-cyan}{<module>}
\textcolor{ansi-green}{----> 1}\textcolor{ansi-red}{ SEAS5\_UK = (SEAS5['tprate']
}\textcolor{ansi-green-intense}{\textbf{      2}}             \textcolor{ansi-blue}{.}where\textcolor{ansi-blue}{(}SEAS5\_mask \textcolor{ansi-blue}{==} \textcolor{ansi-cyan}{31}\textcolor{ansi-blue}{)}
\textcolor{ansi-green-intense}{\textbf{      3}}             .mean(dim=['latitude', 'longitude']))
\textcolor{ansi-green-intense}{\textbf{      4}} SEAS5\_UK

\textcolor{ansi-red}{NameError}: name 'SEAS5' is not defined
\end{sphinxVerbatim}
}

However, xarray does not take into account the area of the gridcells in taking the average. Therefore, we have to calculate the \sphinxhref{http://xarray.pydata.org/en/stable/examples/area\_weighted\_temperature.html}{area\sphinxhyphen{}weighted mean} of the gridcells. To calculate the area of each gridcell, I use cdo \sphinxcode{\sphinxupquote{cdo gridarea infile outfile}}. Here I load the generated file:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[12]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{Gridarea\PYGZus{}SEAS5} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/Gridarea\PYGZus{}SEAS5.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{Gridarea\PYGZus{}SEAS5}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cell\PYGZus{}area}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[12]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.QuadMesh at 0x7f8771a14bd0>
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=381\sphinxpxdimen,height=274\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_47_1}.png}

\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[13]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted} \PYG{o}{=} \PYG{p}{(}\PYG{n}{SEAS5}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tprate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
                  \PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}mask} \PYG{o}{==} \PYG{l+m+mi}{31}\PYG{p}{)}
                  \PYG{o}{.}\PYG{n}{weighted}\PYG{p}{(}\PYG{n}{Gridarea\PYGZus{}SEAS5}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cell\PYGZus{}area}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
                  \PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
                 \PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[13]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray (leadtime: 5, time: 35, number: 25)>
array([[[1.74715784, 1.91625164, 3.74246331, {\ldots}, 2.9025497 ,
         1.87161458, 2.42337871],
        [3.01557164, 1.86355946, 4.23964218, {\ldots}, 2.82348107,
         4.08311346, 2.45320866],
        [3.45037457, 3.67373672, 3.19124952, {\ldots}, 5.10772697,
         3.83928173, 2.59254324],
        {\ldots},
        [2.91576568, 3.76689869, 4.64815469, {\ldots}, 1.61583385,
         3.07634248, 1.633837  ],
        [2.8217756 , 3.61588493, 2.61442489, {\ldots}, 3.36894025,
         5.01010622, 3.58215465],
        [2.21954162, 2.46237273, 3.71758684, {\ldots}, 3.72850729,
         1.21044478, 3.5506569 ]],

       [[1.08925258, 1.502868  , 3.23383862, {\ldots}, 1.49745391,
         2.74434639, 0.98857514],
        [0.96385251, 2.9144073 , 2.14176199, {\ldots}, 3.39404417,
         2.837949  , 4.39105086],
        [3.64189637, 3.44186084, 1.96817031, {\ldots}, 3.90560029,
         3.78419096, 3.13070979],
        {\ldots},
        [2.46681904, 3.55272741, 3.41184678, {\ldots}, 2.58295751,
         3.84194729, 3.71967185],
        [1.96088291, 3.64719353, 2.73561159, {\ldots}, 3.56311814,
         2.00379361, 3.89548019],
        [1.89263296, 1.99179138, 2.91457733, {\ldots}, 3.37011609,
         3.05092884, 1.89736692]],

       [[1.94362083, 2.4160058 , 1.36431312, {\ldots}, 1.78378666,
         1.82209387, 2.42526171],
        [2.57294707, 3.55756557, 2.96458594, {\ldots}, 3.26071746,
         2.60226357, 3.13573254],
        [4.13926899, 2.61380816, 3.76440713, {\ldots}, 1.87333769,
         1.82042494, 4.46818308],
        {\ldots},
        [2.81221309, 2.69631474, 1.80062933, {\ldots}, 2.86429728,
         3.13303958, 3.44787769],
        [2.07369663, 2.03958281, 2.81885547, {\ldots}, 2.65322161,
         3.32297921, 2.83923239],
        [3.49884241, 3.63866711, 2.03510114, {\ldots}, 3.24500072,
         3.15147085, 2.16834782]],

       [[2.83876303, 3.61651907, 1.0950032 , {\ldots}, 1.17176117,
         2.91180608, 2.1047135 ],
        [3.95351432, 1.78778573, 3.08959013, {\ldots}, 3.43481603,
         2.72829325, 3.6158294 ],
        [3.13152664, 2.19419128, 3.64975772, {\ldots}, 0.83938823,
         4.01702257, 3.46619512],
        {\ldots},
        [2.90135673, 5.59148292, 1.70016201, {\ldots}, 2.08532097,
         1.84797942, 2.23519466],
        [4.19777172, 3.74702108, 2.8748067 , {\ldots}, 1.88071816,
         0.62889528, 2.79973163],
        [1.51194718, 3.07317605, 2.05956574, {\ldots}, 2.53950207,
         4.70096128, 2.04542173]],

       [[3.15063505, 3.23490175, 2.60923731, {\ldots}, 4.27225421,
         1.29816875, 1.42799228],
        [2.21017692, 3.32458317, 2.3819878 , {\ldots}, 2.53619218,
         4.24655687, 3.21280586],
        [4.07655988, 2.07606666, 1.75961194, {\ldots}, 4.47653645,
         1.81676988, 4.21655002],
        {\ldots},
        [1.82563235, 3.10218576, 2.46347745, {\ldots}, 1.28711195,
         2.36333743, 2.26540939],
        [4.63821163, 4.43540009, 2.37741808, {\ldots}, 4.44346938,
         1.27125796, 2.63467098],
        [3.12914205, 2.58186504, 2.11029128, {\ldots}, 3.6635387 ,
         1.68374372, 1.9288108 ]]])
Coordinates:
  * time      (time) datetime64[ns] 1982-02-01 1983-02-01 {\ldots} 2016-02-01
  * number    (number) int32 0 1 2 3 4 5 6 7 8 9 {\ldots} 16 17 18 19 20 21 22 23 24
  * leadtime  (leadtime) int64 2 3 4 5 6
\end{sphinxVerbatim}
}

What is the difference between the weighted and non\sphinxhyphen{}weighted average?

I plot the UK average for ensemble member 0 and leadtime 2

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[14]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{leadtime}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{number}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{leadtime}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{number}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}

\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[14]:\,\hspace{\fboxrule}\hspace{\fboxsep}}[<matplotlib.lines.Line2D at 0x7f87718f8b50>]
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[14]:\,\hspace{\fboxrule}\hspace{\fboxsep}}[<matplotlib.lines.Line2D at 0x7f87718e3ad0>]
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=362\sphinxpxdimen,height=290\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_50_2}.png}

\end{nbsphinxfancyoutput}

And a scatter plot of all ensemble members, leadtimes and years also shows little influence

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[15]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}UK}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[15]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.PathCollection at 0x7f877b4ffb10>
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=362\sphinxpxdimen,height=248\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_52_1}.png}

\end{nbsphinxfancyoutput}


\subsection{EOBS}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:EOBS}}
Same for EOBS. Because this is a larger domain on higher resolution, there are more countries and they look more realistic.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[52]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{EOBS\PYGZus{}mask} \PYG{o}{=} \PYG{n}{countries}\PYG{o}{.}\PYG{n}{mask}\PYG{p}{(}\PYG{n}{EOBS}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1982}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                            \PYG{n}{lon\PYGZus{}name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                            \PYG{n}{lat\PYGZus{}name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{EOBS\PYGZus{}mask}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{EOBS\PYGZus{}mask}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[52]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.QuadMesh at 0x7f86ec225650>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[52]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray 'region' (latitude: 201, longitude: 464)>
array([[ nan,  nan,  nan, {\ldots}, 144., 144., 144.],
       [ nan,  nan,  nan, {\ldots}, 144., 144., 144.],
       [ nan,  nan,  nan, {\ldots}, 144., 144., 144.],
       {\ldots},
       [181., 181., 181., {\ldots},  nan,  nan,  nan],
       [181., 181., 181., {\ldots},  nan,  nan,  nan],
       [181., 181., 181., {\ldots},  nan,  nan,  nan]])
Coordinates:
  * latitude   (latitude) float64 25.38 25.62 25.88 26.12 {\ldots} 74.88 75.12 75.38
  * longitude  (longitude) float64 -40.38 -40.12 -39.88 {\ldots} 74.88 75.12 75.38
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=383\sphinxpxdimen,height=262\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_54_2}.png}

\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[53]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{Gridarea\PYGZus{}EOBS} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../UK\PYGZus{}example/Gridarea\PYGZus{}EOBS.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{Gridarea\PYGZus{}EOBS}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cell\PYGZus{}area}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[53]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.QuadMesh at 0x7f86ec4060d0>
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=383\sphinxpxdimen,height=286\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_55_1}.png}

\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[54]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted} \PYG{o}{=} \PYG{p}{(}\PYG{n}{EOBS}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
                  \PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{EOBS\PYGZus{}mask} \PYG{o}{==} \PYG{l+m+mi}{31}\PYG{p}{)}
                  \PYG{o}{.}\PYG{n}{weighted}\PYG{p}{(}\PYG{n}{Gridarea\PYGZus{}EOBS}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cell\PYGZus{}area}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
                  \PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
                 \PYG{p}{)}
\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted}
\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[54]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<xarray.DataArray (time: 71)>
array([4.0112636 , 3.19827003, 1.11268281, 1.61090816, 2.69306677,
       2.31978493, 0.98650601, 2.63477555, 3.63657055, 0.52167151,
       2.50233819, 2.93969127, 2.06443877, 0.99136675, 1.01560624,
       0.6154935 , 3.93636015, 3.39010865, 1.53137533, 2.15598489,
       3.32269875, 1.78223544, 2.45083221, 2.03587884, 3.3849171 ,
       1.08231163, 1.76152991, 4.20162284, 2.66144679, 1.6568065 ,
       2.91595009, 2.0847285 , 2.17290317, 1.39570346, 2.22253168,
       1.05645274, 0.45730501, 2.02864268, 2.73456517, 4.08896735,
       6.21272081, 2.17751273, 2.52523671, 0.85118189, 2.77141892,
       4.3647128 , 3.00077761, 5.26563969, 2.21997571, 2.63596739,
       4.05858217, 3.15371361, 5.65114533, 1.43401958, 1.96796786,
       2.000555  , 1.87548527, 3.55486921, 2.31611654, 1.74042428,
       2.21678709, 3.55429198, 1.4882801 , 1.77628824, 5.3601659 ,
       2.39871296, 3.39117348, 2.92421785, 1.5737706 , 1.85412429,
       4.91373273])
Coordinates:
  * time     (time) datetime64[ns] 1950-02-28 1951-02-28 {\ldots} 2020-02-29
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[54]:\,\hspace{\fboxrule}\hspace{\fboxsep}}[<matplotlib.lines.Line2D at 0x7f86ec7761d0>]
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=362\sphinxpxdimen,height=274\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_56_2}.png}

\end{nbsphinxfancyoutput}


\subsubsection{Save the datasets}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Save-the-datasets}}
{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[55]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{to\PYGZus{}netcdf}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/SEAS5\PYGZus{}UK\PYGZus{}weighted.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{to\PYGZus{}netcdf}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/EOBS\PYGZus{}UK\PYGZus{}weighted.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} save as netcdf}
\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{to\PYGZus{}pandas}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data/EOBS\PYGZus{}UK\PYGZus{}weighted.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZsh{} and save as csv.}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[59]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}


\subsubsection{Illustrate the SEAS5 and EOBS masks for the UK}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Illustrate-the-SEAS5-and-EOBS-masks-for-the-UK}}
Here I plot the masked mean SEAS5 and EOBS precipitation. EOBS is averaged over 71 years, SEAS5 is averaged over years, leadtime and ensemble members.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[57]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{fig}\PYG{p}{,} \PYG{n}{axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{subplot\PYGZus{}kw}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{projection}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{OSGB}\PYG{p}{(}\PYG{p}{)}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{SEAS5}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tprate}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}mask} \PYG{o}{==} \PYG{l+m+mi}{31}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}
    \PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{leadtime}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}
    \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
    \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{8}\PYG{p}{,}
    \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{,}
    \PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{EOBS}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{EOBS\PYGZus{}mask} \PYG{o}{==} \PYG{l+m+mi}{31}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}
    \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
    \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mi}{8}\PYG{p}{,}
    \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{Blues}\PYG{p}{,}
    \PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{ax} \PYG{o+ow}{in} \PYG{n}{axs}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{coastlines}\PYG{p}{(}\PYG{n}{resolution}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{10m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SEAS5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{EOBS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/soge-home/users/cenv0732/.conda/envs/upscale/lib/python3.7/site-packages/xarray/core/nanops.py:142: RuntimeWarning: Mean of empty slice
  return np.nanmean(a, axis=axis, dtype=dtype)
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[57]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.QuadMesh at 0x7f86ec0bef90>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/soge-home/users/cenv0732/.conda/envs/upscale/lib/python3.7/site-packages/xarray/core/nanops.py:142: RuntimeWarning: Mean of empty slice
  return np.nanmean(a, axis=axis, dtype=dtype)
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[57]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.QuadMesh at 0x7f86ec0be890>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[57]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<cartopy.mpl.feature\_artist.FeatureArtist at 0x7f86ec464ed0>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[57]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<cartopy.mpl.feature\_artist.FeatureArtist at 0x7f86bfe37350>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[57]:\,\hspace{\fboxrule}\hspace{\fboxsep}}Text(0.5, 1.0, 'SEAS5')
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[57]:\,\hspace{\fboxrule}\hspace{\fboxsep}}Text(0.5, 1.0, 'EOBS')
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=361\sphinxpxdimen,height=253\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_61_8}.png}

\end{nbsphinxfancyoutput}


\subsubsection{Illustrate the SEAS5 and EOBS UK average}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Illustrate-the-SEAS5-and-EOBS-UK-average}}
And the area\sphinxhyphen{}weighted average UK precipitation for SEAS5 and EOBS I plot here. For SEAS5 I plot the range, both min/max and the 2.5/97.5 \% percentile of all ensemble members and leadtimes for each year.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{axes}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{Quantiles} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{quantile}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mf}{2.5}\PYG{o}{/}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{97.5}\PYG{o}{/}\PYG{l+m+mi}{100}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{leadtime}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{time}\PYG{p}{,} \PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{quantile}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orange}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{label} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SEAS5 median}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{quantile}\PYG{o}{=}\PYG{l+m+mf}{0.025}\PYG{p}{)}\PYG{p}{,} \PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{quantile}\PYG{o}{=}\PYG{l+m+mf}{0.975}\PYG{p}{)}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orange}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,}\PYG{n}{label} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{95}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{ / min max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{quantile}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,} \PYG{n}{Quantiles}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{quantile}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{orange}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{)}

\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{label} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{E\PYGZhy{}OBS}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Quantiles\PYGZus{}EOBS = EOBS[\PYGZsq{}rr\PYGZsq{}].where(EOBS\PYGZus{}mask == 143).mean(dim = [\PYGZsq{}latitude\PYGZsq{},\PYGZsq{}longitude\PYGZsq{}]).quantile([2.5/100, 0.5, 97.5/100], dim=[\PYGZsq{}time\PYGZsq{}])\PYGZsh{}.plot()}
\PYG{c+c1}{\PYGZsh{} ax.plot(EOBS.time, np.repeat(Quantiles\PYGZus{}EOBS.sel(quantile=0.5).values,71), color=\PYGZsq{}blue\PYGZsq{},linestyle = \PYGZsq{}\PYGZhy{}\PYGZhy{}\PYGZsq{},linewidth = 1)}
\PYG{c+c1}{\PYGZsh{} ax.plot(EOBS.time, np.repeat(Quantiles\PYGZus{}EOBS.sel(quantile=2.5/100).values,71), color=\PYGZsq{}blue\PYGZsq{},linestyle = \PYGZsq{}\PYGZhy{}\PYGZhy{}\PYGZsq{},linewidth = 1)}
\PYG{c+c1}{\PYGZsh{} ax.plot(EOBS.time, np.repeat(Quantiles\PYGZus{}EOBS.sel(quantile=97.5/100).values,71), color=\PYGZsq{}blue\PYGZsq{},linestyle = \PYGZsq{}\PYGZhy{}\PYGZhy{}\PYGZsq{},linewidth = 1)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lower left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ncol}\PYG{o}{=}\PYG{l+m+mi}{2} \PYG{p}{)}\PYG{c+c1}{\PYGZsh{}loc = (0.1, 0) upper left}

\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}[<matplotlib.lines.Line2D at 0x7f86d0e2d3d0>]
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.PolyCollection at 0x7f86d0d51650>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.collections.PolyCollection at 0x7f86d0d51ed0>
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}[<matplotlib.lines.Line2D at 0x7f86d0d583d0>]
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxout}[58]:\,\hspace{\fboxrule}\hspace{\fboxsep}}<matplotlib.legend.Legend at 0x7f86d0d51850>
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=362\sphinxpxdimen,height=274\sphinxpxdimen]{{Notebooks_2.Preprocess_2.Preprocess_63_5}.png}

\end{nbsphinxfancyoutput}


\subsection{Potential improvements}
\label{\detokenize{Notebooks/2.Preprocess/2.Preprocess:Potential-improvements}}
There are many different sources and methods available for extracting areal\sphinxhyphen{}averages from shapefiles. Here I have used shapely / masking in xarray. Something that lacks with this method is the weighted extraction from a shapefile, that is more precise on the boundaries. In R, raster:extract can use the percentage of the area that falls within the country for each grid cell to use as weight in averaging. For more information on this method, see the EGU 2018 course:
https://github.com/hydrosoc/rhydro\_EGU18/blob/master/netCDF.pdf. For SEAS5, with its coarse resolution, this might make a difference. However, for it’s speed and reproducibility, we have chosen to stick to xarray.

We have used xarray where you can apply weights yourself to a dataset and then calculate the weighted mean. Sources I have used: \sphinxhref{http://xarray.pydata.org/en/stable/computation.html\#weighted-array-reductions}{xarray weighted reductions} \sphinxhref{http://www.matteodefelice.name/post/aggregating-gridded-data/}{Matteo’s blog} \sphinxhref{https://regionmask.readthedocs.io/en/stable/\#}{regionmask package} \sphinxhref{https://nordicesmhub.github.io/NEGI-Abisko-2019/training/Example\_model\_global\_arctic\_average.html}{Arctic weighted average
example} and \sphinxhref{http://xarray.pydata.org/en/stable/examples/area\_weighted\_temperature.html}{area weighted temperature example}.

Instead of xarray, the areal weighing can be done in iris: \sphinxurl{https://www.wemcouncil.org/wp/wemc-tech-blog-4-5-calculating-nuts2-regional-averages-with-land-sea-mask/}. It still doesn’t solve the problem with country borders. Since I don’t know iris and have been working in xarray, I have not further explored that method.

Two options we could still explore to improve the extraction:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
Do the extraction in R and compare it to the current xarray method.

\item {} 
Upscale EOBS to the SEAS5 grid and then mask: We could regrid EOBS to the SEAS5 grid and then select the same gridcells for both datasets. The country outline would not be perfect, but the masks would be the same so the comparison would be fair. I think this method is most commonly applied in climate science, where you regrid all your xx datasets to the same grid so you can compare them. Pro: pragmatic. Con: not a perfect country definition. I explore this in {[}1.5Upscale{]} Source: This pretty
\sphinxhref{https://colab.research.google.com/drive/1wWHz\_SMCHNuos5fxWRUJTcB6wqkTJQCR\#scrollTo=B8PyoC1vXvd-}{awesome colab notebook} on seasonal forecasting regrids seasonal forecasts and reanalysis on the same grid before calculating skill scores

\end{enumerate}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[ ]:\,\hspace{\fboxrule}\hspace{\fboxsep}}
\end{sphinxVerbatim}
}


\chapter{Evaluate}
\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate:Evaluate}}\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate::doc}}
Can seasonal forecasts be used as ‘alternate’ realities? Here we show how a set of evaluation metrics can be used to answer this question. The evaluation metrics are available through an \sphinxhref{https://github.com/timokelder/UNSEEN}{R package} for easy evaluation of the UNSEEN ensemble. Here, we illustrate how this package can be used in the UNSEEN workflow. We will evaluate the generated UNSEEN ensemble of UK February precipitation and of MAM Siberian heatwaves.

\begin{sphinxadmonition}{note}{}\unskip
Note

This is R code and not python!

We switch to R since we believe R has a better functionality in extreme value statistics.
\end{sphinxadmonition}


\section{Set up}
\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate:Set-up}}
First, we set the working directory to the UNSEEN\sphinxhyphen{}open directory, then we load the UNSEEN and lubridate package. We need lubridate to convert the time class from character to Date.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[1]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{setwd}\PYG{p}{(}\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{../../..\PYGZsq{}}\PYG{p}{)}
\PYG{n+nf}{getwd}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}
'/lustre/soge1/projects/ls/personal/timo/UNSEEN-open'
\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[2]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{library}\PYG{p}{(}\PYG{n}{UNSEEN}\PYG{p}{)}
\end{sphinxVerbatim}
}


\section{Read the data and convert the time column}
\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate:Read-the-data-and-convert-the-time-column}}
The data that is imported here are the files stored at the end of step 1: Download, see for example \sphinxhref{https://nbviewer.jupyter.org/github/esowc/UNSEEN-open/blob/master/Notebooks/1.Download/1.5Upscale.ipynb}{1.5}.

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[9]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n+nf}{read.csv}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{Data/SEAS5\PYGZus{}Siberia\PYGZus{}events.csv\PYGZdq{}}\PYG{p}{,} \PYG{n}{stringsAsFactors}\PYG{o}{=}\PYG{k+kc}{FALSE}\PYG{p}{)}
\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n+nf}{read.csv}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{Data/ERA5\PYGZus{}Siberia\PYGZus{}events.csv\PYGZdq{}}\PYG{p}{,} \PYG{n}{stringsAsFactors}\PYG{o}{=}\PYG{k+kc}{FALSE}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n+nf}{read.csv}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{Data/SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed.csv\PYGZdq{}}\PYG{p}{,} \PYG{n}{stringsAsFactors}\PYG{o}{=}\PYG{k+kc}{FALSE}\PYG{p}{)}
\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n+nf}{read.csv}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{Data/ERA5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed.csv\PYGZdq{}}\PYG{p}{,} \PYG{n}{stringsAsFactors}\PYG{o}{=}\PYG{k+kc}{FALSE}\PYG{p}{)}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[11]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{head}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{p}{,}\PYG{n}{n} \PYG{o}{=} \PYG{l+m}{60}\PYG{p}{)}\PYG{c+c1}{\PYGZsh{}SEAS5\PYGZus{}Siberia\PYGZus{}events)}
\PYG{n+nf}{head}\PYG{p}{(}\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events}\PYG{p}{)}
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}
A data.frame: 60 × 4
\begin{tabular}{r|llll}
  & year & leadtime & number & t2m\\
  & <int> & <int> & <int> & <dbl>\\
\hline
    1 & 1982 & 2 &  0 & 269.4135\\
    2 & 1982 & 2 &  1 & 267.4672\\
    3 & 1982 & 2 &  2 & 268.9286\\
    4 & 1982 & 2 &  3 & 266.7581\\
    5 & 1982 & 2 &  4 & 269.6455\\
    6 & 1982 & 2 &  5 & 267.9472\\
    7 & 1982 & 2 &  6 & 268.7578\\
    8 & 1982 & 2 &  7 & 267.4984\\
    9 & 1982 & 2 &  8 & 270.1133\\
    10 & 1982 & 2 &  9 & 269.1066\\
    11 & 1982 & 2 & 10 & 267.1255\\
    12 & 1982 & 2 & 11 & 269.3180\\
    13 & 1982 & 2 & 12 & 270.1963\\
    14 & 1982 & 2 & 13 & 268.2139\\
    15 & 1982 & 2 & 14 & 268.4484\\
    16 & 1982 & 2 & 15 & 269.4942\\
    17 & 1982 & 2 & 16 & 268.6117\\
    18 & 1982 & 2 & 17 & 267.6257\\
    19 & 1982 & 2 & 18 & 268.5591\\
    20 & 1982 & 2 & 19 & 266.7554\\
    21 & 1982 & 2 & 20 & 270.5969\\
    22 & 1982 & 2 & 21 & 265.1094\\
    23 & 1982 & 2 & 22 & 268.7506\\
    24 & 1982 & 2 & 23 & 267.0415\\
    25 & 1982 & 2 & 24 & 268.6641\\
    26 & 1982 & 2 & 25 &       NA\\
    27 & 1982 & 2 & 26 &       NA\\
    28 & 1982 & 2 & 27 &       NA\\
    29 & 1982 & 2 & 28 &       NA\\
    30 & 1982 & 2 & 29 &       NA\\
    31 & 1982 & 2 & 30 &       NA\\
    32 & 1982 & 2 & 31 &       NA\\
    33 & 1982 & 2 & 32 &       NA\\
    34 & 1982 & 2 & 33 &       NA\\
    35 & 1982 & 2 & 34 &       NA\\
    36 & 1982 & 2 & 35 &       NA\\
    37 & 1982 & 2 & 36 &       NA\\
    38 & 1982 & 2 & 37 &       NA\\
    39 & 1982 & 2 & 38 &       NA\\
    40 & 1982 & 2 & 39 &       NA\\
    41 & 1982 & 2 & 40 &       NA\\
    42 & 1982 & 2 & 41 &       NA\\
    43 & 1982 & 2 & 42 &       NA\\
    44 & 1982 & 2 & 43 &       NA\\
    45 & 1982 & 2 & 44 &       NA\\
    46 & 1982 & 2 & 45 &       NA\\
    47 & 1982 & 2 & 46 &       NA\\
    48 & 1982 & 2 & 47 &       NA\\
    49 & 1982 & 2 & 48 &       NA\\
    50 & 1982 & 2 & 49 &       NA\\
    51 & 1982 & 2 & 50 &       NA\\
    52 & 1982 & 3 &  0 & 267.3054\\
    53 & 1982 & 3 &  1 & 269.4579\\
    54 & 1982 & 3 &  2 & 267.8808\\
    55 & 1982 & 3 &  3 & 266.1220\\
    56 & 1982 & 3 &  4 & 266.8159\\
    57 & 1982 & 3 &  5 & 268.4771\\
    58 & 1982 & 3 &  6 & 267.9680\\
    59 & 1982 & 3 &  7 & 269.0933\\
    60 & 1982 & 3 &  8 & 266.9857\\
\end{tabular}
\end{nbsphinxfancyoutput}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}
A data.frame: 6 × 2
\begin{tabular}{r|ll}
  & year & t2m\\
  & <int> & <dbl>\\
\hline
    1 & 1979 & 277.1607\\
    2 & 1980 & 277.0310\\
    3 & 1981 & 277.9729\\
    4 & 1982 & 277.9191\\
    5 & 1983 & 277.9752\\
    6 & 1984 & 277.6508\\
\end{tabular}
\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[4]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n+nf}{read.csv}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{Data/EOBS\PYGZus{}UK\PYGZus{}weighted\PYGZus{}upscaled.csv\PYGZdq{}}\PYG{p}{,} \PYG{n}{stringsAsFactors}\PYG{o}{=}\PYG{k+kc}{FALSE}\PYG{p}{)}
\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n+nf}{read.csv}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}}\PYG{l+s}{Data/SEAS5\PYGZus{}UK\PYGZus{}weighted\PYGZus{}masked.csv\PYGZdq{}}\PYG{p}{,} \PYG{n}{stringsAsFactors}\PYG{o}{=}\PYG{k+kc}{FALSE}\PYG{p}{)}
\end{sphinxVerbatim}
}

And then convert the time class to Date format, with the ymd function in lubridate:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[5]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{o}{\PYGZdl{}}\PYG{n}{time} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n}{lubridate}\PYG{o}{::}\PYG{n+nf}{ymd}\PYG{p}{(}\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{o}{\PYGZdl{}}\PYG{n}{time}\PYG{p}{)}
\PYG{n+nf}{str}\PYG{p}{(}\PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{p}{)}

\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{o}{\PYGZdl{}}\PYG{n}{time} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n}{lubridate}\PYG{o}{::}\PYG{n+nf}{ymd}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{o}{\PYGZdl{}}\PYG{n}{time}\PYG{p}{)}
\PYG{n+nf}{str}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
'data.frame':   71 obs. of  2 variables:
 \$ time: Date, format: "1950-02-28" "1951-02-28" {\ldots}
 \$ rr  : num  4.13 3.25 1.07 1.59 2.59 {\ldots}
'data.frame':   4375 obs. of  4 variables:
 \$ leadtime: int  2 2 2 2 2 2 2 2 2 2 {\ldots}
 \$ number  : int  0 0 0 0 0 0 0 0 0 0 {\ldots}
 \$ time    : Date, format: "1982-02-01" "1983-02-01" {\ldots}
 \$ tprate  : num  1.62 2.93 3.27 2 3.31 {\ldots}
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[12]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events}\PYG{o}{\PYGZdl{}}\PYG{n}{year} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n}{lubridate}\PYG{o}{::}\PYG{n+nf}{ymd}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events}\PYG{o}{\PYGZdl{}}\PYG{n}{year}\PYG{p}{)}
\PYG{n+nf}{str}\PYG{p}{(}\PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events}\PYG{p}{)}

\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events}\PYG{o}{\PYGZdl{}}\PYG{n}{year} \PYG{o}{\PYGZlt{}\PYGZhy{}} \PYG{n}{lubridate}\PYG{o}{::}\PYG{n+nf}{ymd}\PYG{p}{(}\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events}\PYG{o}{\PYGZdl{}}\PYG{n}{year}\PYG{p}{)}
\PYG{n+nf}{str}\PYG{p}{(}\PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Warning message:
“All formats failed to parse. No formats found.”
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
'data.frame':   2625 obs. of  4 variables:
 \$ year    : Date, format: NA NA {\ldots}
 \$ leadtime: int  2 2 2 2 2 2 2 2 2 2 {\ldots}
 \$ number  : int  0 1 2 3 4 5 6 7 8 9 {\ldots}
 \$ t2m     : num  278 277 277 276 278 {\ldots}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Warning message:
“All formats failed to parse. No formats found.”
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
'data.frame':   42 obs. of  2 variables:
 \$ year: Date, format: NA NA {\ldots}
 \$ t2m : num  277 277 278 278 278 {\ldots}
\end{sphinxVerbatim}
}


\subsection{Timeseries}
\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate:Timeseries}}
{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[12]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{unseen\PYGZus{}timeseries}\PYG{p}{(}
    \PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{p}{,}
    \PYG{n}{obs} \PYG{o}{=} \PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{p}{,}
    \PYG{n}{ensemble\PYGZus{}yname} \PYG{o}{=} \PYG{l+s}{\PYGZdq{}}\PYG{l+s}{t2m\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{ensemble\PYGZus{}xname} \PYG{o}{=} \PYG{l+s}{\PYGZdq{}}\PYG{l+s}{year\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{obs\PYGZus{}yname} \PYG{o}{=} \PYG{l+s}{\PYGZdq{}}\PYG{l+s}{t2m\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{obs\PYGZus{}xname} \PYG{o}{=} \PYG{l+s}{\PYGZdq{}}\PYG{l+s}{year\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{ylab} \PYG{o}{=} \PYG{l+s}{\PYGZdq{}}\PYG{l+s}{MAM Siberian temperature\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Warning message:
“Removed 2756 rows containing non-finite values (stat\_boxplot).”
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=420\sphinxpxdimen,height=420\sphinxpxdimen]{{Notebooks_3.Evaluate_3.Evaluate_14_1}.png}

\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[19]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{unseen\PYGZus{}timeseries}\PYG{p}{(}\PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{p}{,} \PYG{n}{obs} \PYG{o}{=} \PYG{n}{EOBS\PYGZus{}UK\PYGZus{}weighted\PYGZus{}df}\PYG{p}{,} \PYG{n}{ylab} \PYG{o}{=} \PYG{l+s}{\PYGZsq{}}\PYG{l+s}{UK February precipitation (mm/d)\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=420\sphinxpxdimen,height=420\sphinxpxdimen]{{Notebooks_3.Evaluate_3.Evaluate_15_0}.png}

\end{nbsphinxfancyoutput}

Call the documentation of the function with \sphinxcode{\sphinxupquote{?unseen\_timeseries}}


\subsection{Independence}
\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate:Independence}}
Significance ranges need fixing + detrend method (Rob)

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[13]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{independence\PYGZus{}test}\PYG{p}{(}
    \PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{p}{,}
    \PYG{n}{n\PYGZus{}lds} \PYG{o}{=} \PYG{l+m}{3}\PYG{p}{,}
    \PYG{n}{var\PYGZus{}name} \PYG{o}{=} \PYG{l+s}{\PYGZdq{}}\PYG{l+s}{t2m\PYGZdq{}}\PYG{p}{,}
\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Warning message:
“Removed 975 rows containing non-finite values (stat\_ydensity).”
Warning message:
“Removed 975 rows containing non-finite values (stat\_boxplot).”
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=420\sphinxpxdimen,height=420\sphinxpxdimen]{{Notebooks_3.Evaluate_3.Evaluate_19_1}.png}

\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[7]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{independence\PYGZus{}test}\PYG{p}{(}\PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}UK}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Warning message:
“Removed 1625 rows containing non-finite values (stat\_ydensity).”
Warning message:
“Removed 1625 rows containing non-finite values (stat\_boxplot).”
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=420\sphinxpxdimen,height=420\sphinxpxdimen]{{Notebooks_3.Evaluate_3.Evaluate_20_1}.png}

\end{nbsphinxfancyoutput}


\subsection{Stability}
\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate:Stability}}
Na.rm = True needed

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[14]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{stability\PYGZus{}test}\PYG{p}{(}
    \PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{p}{,}
    \PYG{n}{lab} \PYG{o}{=} \PYG{l+s}{\PYGZsq{}}\PYG{l+s}{MAM Siberian temperature\PYGZsq{}}\PYG{p}{,}
    \PYG{n}{var\PYGZus{}name} \PYG{o}{=} \PYG{l+s}{\PYGZsq{}}\PYG{l+s}{t2m\PYGZsq{}}
\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Error in quantile.default(newX[, i], {\ldots}): missing values and NaN's not allowed if 'na.rm' is FALSE
Traceback:

1. stability\_test(ensemble = SEAS5\_Siberia\_events\_zoomed, lab = "MAM Siberian temperature",
 .     var\_name = "t2m")
2. Model\_stability\_boot(ensemble = ensemble, var\_name = var\_name,
 .     ld\_name = ld\_name, lab = lab)
3. apply(bootstrapped\_array, MARGIN = 2, FUN = stats::quantile,
 .     probs = 1 - 1/(rps))
4. FUN(newX[, i], {\ldots})
5. quantile.default(newX[, i], {\ldots})
6. stop("missing values and NaN's not allowed if 'na.rm' is FALSE")
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[8]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{stability\PYGZus{}test}\PYG{p}{(}\PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}UK}\PYG{p}{,} \PYG{n}{lab} \PYG{o}{=} \PYG{l+s}{\PYGZsq{}}\PYG{l+s}{UK February precipitation (mm/d)\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{nbsphinx-stderr}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Warning message:
“Removed 4 row(s) containing missing values (geom\_path).”
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=420\sphinxpxdimen,height=420\sphinxpxdimen]{{Notebooks_3.Evaluate_3.Evaluate_24_1}.png}

\end{nbsphinxfancyoutput}


\subsection{Fidelity}
\label{\detokenize{Notebooks/3.Evaluate/3.Evaluate:Fidelity}}
Unit is incorrect + na.rm = False (needs to be true) \sphinxhyphen{}\textgreater{} needs fixing

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[15]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{fidelity\PYGZus{}test}\PYG{p}{(}
    \PYG{n}{obs} \PYG{o}{=} \PYG{n}{ERA5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{o}{\PYGZdl{}}\PYG{n}{t2m}\PYG{p}{,}
    \PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}Siberia\PYGZus{}events\PYGZus{}zoomed}\PYG{o}{\PYGZdl{}}\PYG{n}{t2m}\PYG{p}{,}
    \PYG{n}{biascor} \PYG{o}{=} \PYG{k+kc}{TRUE}
\PYG{p}{)}
\end{sphinxVerbatim}
}

{

\kern-\sphinxverbatimsmallskipamount\kern-\baselineskip
\kern+\FrameHeightAdjust\kern-\fboxrule
\vspace{\nbsphinxcodecellspacing}

\sphinxsetup{VerbatimColor={named}{white}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Error in quantile.default(bootstrapped\_fun, probs = c(0.025, 0.975)): missing values and NaN's not allowed if 'na.rm' is FALSE
Traceback:

1. fidelity\_test(obs = ERA5\_Siberia\_events\_zoomed\$t2m, ensemble = SEAS5\_Siberia\_events\_zoomed\$t2m,
 .     biascor = TRUE)
2. ggpubr::ggarrange(p1\_comb, p2\_comb, p3\_comb, p4\_comb, labels = c("a",
 .     "b", "c", "d"), font.label = list(size = fontsize, color = "black",
 .     face = "bold", family = NULL), ncol = 2, nrow = 2)
3. purrr::map(plots, .plot\_grid, ncol = ncol, nrow = nrow, labels = labels,
 .     label\_size = .lab\$size, label\_fontfamily = .lab\$family, label\_fontface = .lab\$face,
 .     label\_colour = .lab\$color, label\_x = .lab\$label.x, label\_y = .lab\$label.y,
 .     hjust = .lab\$hjust, vjust = .lab\$vjust, align = align, rel\_widths = widths,
 .     rel\_heights = heights, legend = legend, common.legend.grob = legend.grob)
4. .f(.x[[i]], {\ldots})
5. cowplot::plot\_grid(plotlist = plotlist, {\ldots})
6. align\_plots(plotlist = plots, align = align, axis = axis, greedy = greedy)
7. lapply(plots, function(x) \{
 .     if (!is.null(x))
 .         as\_gtable(x)
 .     else NULL
 . \})
8. FUN(X[[i]], {\ldots})
9. as\_gtable(x)
10. as\_gtable.default(x)
11. as\_grob(plot)
12. as\_grob.ggplot(plot)
13. ggplot2::ggplotGrob(plot)
14. ggplot\_gtable(ggplot\_build(x))
15. ggplot\_build(x)
16. ggplot\_build.ggplot(x)
17. by\_layer(function(l, d) l\$compute\_aesthetics(d, plot))
18. f(l = layers[[i]], d = data[[i]])
19. l\$compute\_aesthetics(d, plot)
20. f({\ldots}, self = self)
21. lapply(aesthetics, eval\_tidy, data = data, env = env)
22. FUN(X[[i]], {\ldots})
23. stats::quantile(bootstrapped\_fun, probs = c(0.025, 0.975))
24. quantile.default(bootstrapped\_fun, probs = c(0.025, 0.975))
25. stop("missing values and NaN's not allowed if 'na.rm' is FALSE")
\end{sphinxVerbatim}
}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[9]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{fidelity\PYGZus{}test}\PYG{p}{(}\PYG{n}{obs} \PYG{o}{=} \PYG{n}{EOBS\PYGZus{}UK}\PYG{o}{\PYGZdl{}}\PYG{n}{rr}\PYG{p}{,} \PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}UK}\PYG{o}{\PYGZdl{}}\PYG{n}{tprate}\PYG{p}{)}
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=420\sphinxpxdimen,height=420\sphinxpxdimen]{{Notebooks_3.Evaluate_3.Evaluate_28_0}.png}

\end{nbsphinxfancyoutput}

To include a mean\sphinxhyphen{}bias correction, set \sphinxcode{\sphinxupquote{biascor = TRUE}}:

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[10]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{n+nf}{fidelity\PYGZus{}test}\PYG{p}{(}\PYG{n}{obs} \PYG{o}{=} \PYG{n}{EOBS\PYGZus{}UK}\PYG{o}{\PYGZdl{}}\PYG{n}{rr}\PYG{p}{,} \PYG{n}{ensemble} \PYG{o}{=} \PYG{n}{SEAS5\PYGZus{}UK}\PYG{o}{\PYGZdl{}}\PYG{n}{tprate}\PYG{p}{,} \PYG{n}{biascor} \PYG{o}{=} \PYG{k+kc}{TRUE}\PYG{p}{)}
\end{sphinxVerbatim}
}

\hrule height -\fboxrule\relax
\vspace{\nbsphinxcodecellspacing}

\makeatletter\setbox\nbsphinxpromptbox\box\voidb@x\makeatother

\begin{nbsphinxfancyoutput}

\noindent\sphinxincludegraphics[width=420\sphinxpxdimen,height=420\sphinxpxdimen]{{Notebooks_3.Evaluate_3.Evaluate_30_0}.png}

\end{nbsphinxfancyoutput}

{
\sphinxsetup{VerbatimColor={named}{nbsphinx-code-bg}}
\sphinxsetup{VerbatimBorderColor={named}{nbsphinx-code-border}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\llap{\color{nbsphinxin}[16]:\,\hspace{\fboxrule}\hspace{\fboxsep}}\PYG{o}{?}\PYG{n}{fidelity\PYGZus{}test}
\end{sphinxVerbatim}
}



\renewcommand{\indexname}{Index}
\printindex
\end{document}